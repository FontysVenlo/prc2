<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>PRC2 - 01 Unit Testing Basics</title><link rel=stylesheet href=https://fontysvenlo.github.io/prc2/css/main.min.09f70e5ce2c22335274526a167bcd40f764d430d0f50dd5da87a10731e5bda562e3c86db4f35a99435bec93c0f516dbbb8cb96121b22fa042ce49a961161b31e.css integrity="sha512-CfcOXOLCIzUnRSahZ7zUD3ZNQw0PUN1dqHoQcx5b2lYuPIbbTzWplDW+yTwPUW27uMuWEhsi+gQs5JqWEWGzHg==" crossorigin=anonymous><link rel=stylesheet href=https://fontysvenlo.github.io/prc2/css/highlight.9e5322c61da2ab0997ce2db01648537ffacdb7b808fc24af4d99ff51257c59db9500031551feb8e62cafde7a246ae2c0015c2862637519a22eb0b49fa7b9d2f9.css integrity="sha512-nlMixh2iqwmXzi2wFkhTf/rNt7gI/CSvTZn/USV8WduVAAMVUf645iyv3nokauLAAVwoYmN1GaIusLSfp7nS+Q==" crossorigin=anonymous><link rel=stylesheet href=https://fontysvenlo.github.io/prc2/css/fontawesome.18a15c01c2df9b660114c44bfe1cd143dc48faeea9d5bc11a5b70509d8ec85ae65ac4c6dab72eb09a5c4770d45d6a2d802d28924e739d852a37c1b14f3a9cc61.css integrity="sha512-GKFcAcLfm2YBFMRL/hzRQ9xI+u6p1bwRpbcFCdjsha5lrExtq3LrCaXEdw1F1qLYAtKJJOc52FKjfBsU86nMYQ==" crossorigin=anonymous><script src=/prc2/js/init-darkmode.min.b7911813658cd032d0ed2d118da1fb57653d18386d8b1a26618f83f80019be21e977a1ddeeaeb51dcd1f7d21dfed542a8da077c29eb1ec03d84471bf90d3fabe.js integrity="sha512-t5EYE2WM0DLQ7S0RjaH7V2U9GDhtixomYY+D+AAZviHpd6Hd7q61Hc0ffSHf7VQqjaB3wp6x7APYRHG/kNP6vg==" crossorigin=anonymous></script>
<link rel=apple-touch-icon sizes=180x180 href=https://fontysvenlo.github.io/prc2/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://fontysvenlo.github.io/prc2/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://fontysvenlo.github.io/prc2/favicon-16x16.png></head><body class="antialiased text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800"><header class="sticky top-0 z-40 w-full flex-none lg:border-b lg:border-gray-900/10 dark:border-gray-50/[0.06] bg-white dark:bg-gray-800
border-b border-slate-900/10 lg:border-0 dark:border-slate-300/10"><div class="max-w-8xl mx-auto"><div class="py-4 lg:px-8 mx-4 lg:mx-0"><div class="relative flex items-center"><button id=menu-toggle type=button class="lg:hidden text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 mr-3">
<span class=sr-only>Navigation</span><svg viewBox="0 0 24 24" width="20" height="20" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
<a class="mr-3 flex-none overflow-hidden md:w-auto dark:hover:text-gray-200 hover:text-gray-900" href=https://fontysvenlo.github.io/prc2/>PRC2</a><div class="relative flex ml-auto"><nav class="hidden md:flex items-center text-sm leading-6 font-semibold text-gray-700 dark:text-gray-200"><ul class="flex space-x-8"><li><a href=https://fontysvenlo.github.io/prc2/pages/tips/ class="hover:text-sky-500 dark:hover:text-sky-400">Tips</a></li><li><a href=https://fontysvenlo.github.io/prc2/pages/setup/ class="hover:text-sky-500 dark:hover:text-sky-400">Setup</a></li></ul></nav><div class="flex items-center lg:border-l border-gray-200 ml-6 pl-6 dark:border-gray-700"><button type=button id=theme-toggle>
<span class="dark:hidden hover:text-sky-500"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span><span class="hidden dark:inline hover:text-sky-400"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span></button>
<a href=https://github.com/FontysVenlo/prc2 class="ml-6 block hover:text-sky-500 dark:hover:text-sky-400"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></div></div></div></div></header><div class="max-w-8xl mx-auto px-4 sm:px-6 md:px-8"><aside id=menu class="hidden lg:block fixed z-20 inset-0 top-[3.5rem] left-[max(0px,calc(50%-45rem))] right-auto w-[19.5rem] pb-10 px-8 overflow-y-auto bg-white dark:bg-gray-800"><nav class="lg:leading-6 relative"><ul class="block md:hidden"><li class="mt-12 lg:mt-8"><h5 class="mb-8 lg:mb-3 font-semibold text-slate-900 dark:text-slate-200">General</h5><ul class="space-y-2 border-l border-gray-100 dark:border-gray-700"><li><a href=https://fontysvenlo.github.io/prc2/pages/tips/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">Tips</a></li><li><a href=https://fontysvenlo.github.io/prc2/pages/setup/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">Setup</a></li></ul></li></ul><ul><li class="mt-12 lg:mt-8"><h5 class="mb-8 lg:mb-3 font-semibold text-slate-900 dark:text-slate-200">Weeks</h5><ul class="space-y-2 border-l border-gray-100 dark:border-gray-700"><li><a href=https://fontysvenlo.github.io/prc2/docs/unit-testing-basics/ class="block border-l pl-4 -ml-px
border-slate-500 dark:border-slate-400 text-black dark:text-slate-200">01 Unit Testing Basics</a></li><li><a href=https://fontysvenlo.github.io/prc2/docs/rest/ class="block border-l pl-4 -ml-px
border-transparent hover:border-slate-400 dark:hover:border-slate-400 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200">02 REST API</a></li><li><a href=https://fontysvenlo.github.io/prc2/docs/design-for-testability/ class="block border-l pl-4 -ml-px
border-transparent hover:border-slate-400 dark:hover:border-slate-400 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200">03 Design for testability</a></li></ul></li></ul></nav></aside><div class=lg:pl-[19.5rem]><div class="max-w-3xl mx-auto xl:max-w-none xl:ml-0 xl:mr-[15.5rem] xl:pr-16"><article id=main-content class="prose prose-slate dark:prose-invert max-w-none dark:prose-a:text-fuchsia-400 prose-a:text-fuchsia-500"><nav id=toc class=toc role=doc-toc><h2 id=toc-title>Table of Contents</h2><ol class="toc-list level-1"><li><a href=#_write_your_own_tests>Write your own tests!</a></li><li><a href=#_testing_test_driven_development>Testing / Test Driven Development</a><ol class="toc-list level-2"><li><a href=#_what_are_tests_and_why_do_we_need_them>What are tests and why do we need them?</a></li><li><a href=#_test_driven_development_tdd>Test Driven Development (TDD)</a></li></ol></li><li><a href=#_arrange_act_assert>Arrange Act Assert</a></li><li><a href=#_clues_needed>Clues needed</a></li><li><a href=#_assertj_examples>AssertJ examples.</a><ol class="toc-list level-2"><li><a href=#_simple_tests>Simple Tests</a></li><li><a href=#_string_containment>String Containment</a></li><li><a href=#_collection_containment>Collection Containment</a></li><li><a href=#_assert_exceptions>Assert Exceptions</a></li></ol></li><li><a href=#_soft_assertions>Soft Assertions</a></li><li><a href=#_assumptions>Assumptions</a></li><li><a href=#_additional_pointers>Additional pointers</a></li><li><a href=#_clean_tests>Clean tests</a></li><li><a href=#_parameterized_tests>Parameterized tests</a><ol class="toc-list level-2"><li><a href=#_parameterized_test_junit_5_style>Parameterized test, Junit 5 style</a></li><li><a href=#_lookup_in_a_map>Lookup in a map.</a></li><li><a href=#_test_data_from_a_file>Test data from a file</a></li><li><a href=#_repeated_use_of_same_data>Repeated use of same data.</a></li></ol></li><li><a href=#_test_recipe_i_test_equals_and_hashcode>Test Recipe I, Test Equals and hashCode</a></li><li><a href=#_links>Links</a></li></ol></nav><section class="doc-section level-1"><h2 id=_write_your_own_tests>Write your own tests!</h2><p><span class=big>Throughout the exercises of PRC1, you have become acquainted with the value of tests: You have a way of checking if your code is any good without having to
test each and every part manually. You clicked on the nice TestMyCode (TMC) button in Visual Studio Code (VSC) and then you could see which parts of your code worked, and which didn’t.
There is a catch though: Out there in the real world, there won’t be any button doing that magic for you, nor will some teacher or school
provide the tests for you, so <strong class=red>you will be on your own</strong>.</span></p><p>But fret not! Writing tests is typically much simpler than writing the actual code. At least it is, when you know the anatomy of a test:</p><div class="olist arabic"><ol class=arabic><li><strong class=blue>A</strong>rrange: Prepare or set up the thing you want to test</li><li><strong class=blue>A</strong>ct: Interact with the object you are testing</li><li><strong class=blue>A</strong>ssert that the observable result(s) is/are as expected</li></ol></div><p>Finally, if a test says <strong class=red>boom</strong>, then at least you learned something …​</p><p><strong>Topics week 1</strong></p><div class=ulist><ul><li>Test Driven Development.</li><li>Maven configuration as exercise.</li><li><strong>A</strong>rrange <strong>A</strong>ct <strong>A</strong>ssert.</li><li>JUnit (5) as test framework.</li><li>AssertJ as assertion library.</li></ul></div></section><section class="doc-section level-1"><h2 id=_testing_test_driven_development>Testing / Test Driven Development</h2><section class="doc-section level-2"><h3 id=_what_are_tests_and_why_do_we_need_them>What are tests and why do we need them?</h3><p id=_tdd>The way that you have worked with Java so far is that you had to write some code
to implement something. For example you had to implement a bird watcher system
or a telephone book, in which you could save people with their telephone numbers
and look them up, too. You probably created classes called PhoneBook or
BookEntry,
and you had variables such as <code class=blue>String personName</code>, <code class=blue>int phoneNumber</code> and maybe a
<code class=blue>List</code> or a <code class=blue>Map</code> which contained all the people and their phone numbers. You had to
think about how the phonebook works, and then you added classes, fields (variables)
and methods. Slowly but surely, your phonebook started to look more and more
like a phonebook.</p><figure class="image-block related thumb right" id=tdd-oneRedTest><img src=/prc2/images/tdd-oneRedTest.png alt="tdd oneRedTest"><figcaption>Figure 1. Small steps. One red test at a time.</figcaption></figure><figure class="image-block related thumb left" id=tdd-allTestsGreen><img src=/prc2/images/tdd-allTestsGreen.png alt="tdd allTestsGreen"><figcaption>Figure 2. All the tests are green, yay!</figcaption></figure><p>But how did you know that your phonebook was actually working? You could have
implemented a method that didn’t work, or maybe you forgot to add people to the
phonebook, so the data wasn’t actually stored. What you did was you ran the TMC
tests. They kept telling you whether the phonebook was working as intended. The
test said "<em>when I look for Alice in your phonebook, I will receive Alice’s
phone number 1234-567.</em>". And if the test didn’t receive Alice’s number, it
would turn red and say something like "I expected 1234-567. But I received
0042-987." Therefore, the test fails.</p><p>The tests were a really useful way for you to know that you were indeed
implementing a proper phonebook. You could have just written empty classes and
said "here is the phonebook!" and there would have been no way to verify that
the phonebook works. The test made sure that this doesn’t happen. They also
give you confidence as you code. Because every test that turns green gives you
that little "yes!" feeling that you wrote something that works.</p><p>Thus, tests fulfill two functions at once: they constantly probe your
implementation and check whether it works, and they make you feel more
confident about your programming skills. That’s really neat!</p><figure class="image-block related thumb right" id=tdd-EnglishError><img src=/prc2/images/tdd-EnglishError.png alt="tdd EnglishError"><figcaption>Figure 3. Testing in real life</figcaption></figure><p>When you were at school, you probably had to write an English exam at some
point. You wrote your answers, and then the teacher graded your exam. The
teacher is just like a test: she reads your exam, expecting the correct answer.
For example, you wrote "Alice and Bob goes to school.". Your teacher would get
the red pen and highlight the word "goes". The teacher says "I expected: Alice
and Bob go to school. Instead, I received: Alice and Bob goes to school." The
teachers expectation, or assertion, was not met. Therefore, you get an error.
As you grow older and you become more proficient at English, you write Emails
in English, perhaps for work or at university. When you make a mistake, you
spot your own errors: "oh hang on, I have to use 'go' instead of 'goes' here."
You have internalized a test that checks for the correct conjugation of the
word. You know what to expect, and when you deviate from the expectation, you
spot the error.</p><p>Many people work the same way when they write code. They say "I know what I am
doing because I have experience and I know the rules." But of course, we always
make mistakes. Our brains are really bad testers. We stop seeing mistakes
because we feel so familiar with our code. Have you ever handed in a report for
university, only to find that the lecturer finds spelling errors you swear you
didn’t do? That’s what happens in programming, too.</p><p>That is why we write our own little annoying English teachers that constantly
check: is this correct? Even though we know how to program, we also acknowledge
that our brains are terrible testers for things that you write yourself, so we
give our brains a break and write a test instead.</p></section><section class="doc-section level-2"><h3 id=_test_driven_development_tdd>Test Driven Development (TDD)</h3><p>In <a href=https://materiaalit.github.io/2013-oo-programming/part2/week-9/>Week 9</a>
we wrote a little phonebook and then we ran the test to check that the
phonebook was working. That worked well, because we no longer have to rely on
our brains to spot the errors on-the-fly. But here is another bad message: not
only does our brain stop recognizing errors in our own code, but it is also
automatically biased to want our own tests to pass. You spent all this time
writing your phonebook, you know how it works, so you know what test to write
for it.</p><p>But your brain secretly deceives you: you have implemented a phonebook, and
this is the only phonebook that you know. What if you removed your code, but
leave in the tests- and ask a friend to write a phonebook? They start
complaining that your tests are unfair. "Why do I have to use a List? I use
Maps!" your friend says. But your tests insists that the phonebook has a List.
So what have you done? You have written a test that proves YOUR implementation
is correct.</p><p>When you work test-driven, you don’t implement the phonebook and then test it.
You first write the test for a phonebook, and then you implement it. That
sounds a bit weird at first. Why write tests for stuff that’s not there yet? We
know it’s going to fail! But this is what we want. We need to keep telling our
brains: this does not work. Figure out a way to make it work. This way, it is
much harder to get married to your own code and to stop seeing problems with
your test. You have found a way to deal with the human brain. Congratulations!</p><figure class=image-block style=text-align:center id=tdd-tddLifecycle><img src=/prc2/images/tdd-lifecycle.png alt="tdd lifecycle"><figcaption>Figure 4. <a href=https://medium.com/@odayibasi/tdd-test-driven-development-vs-bdd-behavior-driven-development-30e225c29c14>The TDD Lifecycle. Click for image source.</a></figcaption></figure><section class="doc-section level-3"><h4 id=_so_how_do_i_know_what_to_test>So how do I know what to test?</h4><p>There is a little (actually, it’s big) catch with TDD. When you write a test
for a thing that doesn’t exist yet, how do you know what to test for? If I
write a test for a phonebook that is not implemented yet, what does my test
expect?</p><p>The truth is, you never get around having to make implementation decisions. We
just try to minimize our margin for error. So when you start writing your first
test for your (non-existing) phonebook, you HAVE to have an idea of what the
phonebook does. So perhaps you start with "I expect that the phonebook lets me
look up a person. When I look up Alice, I expect Alice’s phone number.". What
could such a test look like?</p></section><section class="doc-section level-3"><h4 id=_test_selection_strategies>Test selection strategies</h4><p>There is no golden rule that says "always start with text X, and then test Y,
and finish with test Z.". Instead, we rely on heuristics: rules of thumb that
guide us through the TDD process. There are several decisions that you can make
when writing tests.</p><p>For instance, you can decide to first write tests for all elements of the
system under test (SUT), but not go into detail yet what each SUT needs to have
tested. This would mean focusing on width first, and depth later. For instance,
you could write tests for the entirety of the phonebook, but you don’t, for
instance, test each valid or invalid phonebook entry. The other approach would
be to start with the details on one particular part of the test class, and
moving on to other parts only when one section of the SUT is covered
completely. In this version, you go depth-first instead of width-first. Both
approaches have their merit and you need to decide which strategy is best in
which situation.</p><p>Another strategy is to weigh the difficulty of each test. When you look at a
list of tests to write, do you start with the easy ones that are implemented
quickly, or do you start with the more difficult tests that require more
implementation thinking? When you are stuck on a particular test, it might be
useful to first implement a number of tests that are easier to write, so that
you make progress. It might be that whatever was causing you to be stuck on
that test is now easier to solve now that you have a list of other tests that
you have implemented.</p></section><section class="doc-section level-3"><h4 id=_where_to_start>Where to start</h4><p>Choosing is always hard, including choosing where to start. The typical
order for test driven development is:</p><div class="olist arabic"><ol class=arabic><li>A Constructor. You typically need instances and this is how you can construct some.</li><li>Getters for the fields that are defined in the constructor. If
such getters are not part of the public API of the class, make the
package private, to hide them from client classes outside of the
package.</li><li>The <code>public String toString()</code> method, which can show
the result of the constructor. Note that toString is often used for debugging,
and that is what the auto-generated to string typically is for.</li><li>Setters, if needed. (They are NOT in the fraction exercise). If you can get by
with a class without setters, you are typically <a href=https://www.leadingagile.com/2018/03/immutability-in-java/>better off</a>.</li><li>The business methods, one by one. In case of Fraction exercise, start at
multiplication, because that is easiest.</li><li>Further refinements, like in case of the Fraction exercise, that the
fraction should always be in <em>normalised</em> form.</li></ol></div><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>Never add a member (method, field) to a class <em>unless</em> you have a test that proves the need of it.</p></aside><hr></section></section></section><section class="doc-section level-1"><h2 id=_arrange_act_assert>Arrange Act Assert</h2><figure class=video-block><iframe src="//www.youtube.com/embed/GJFGXYyKvns?rel=0" frameborder=0 allowfullscreen></iframe><figcaption>Some action.</figcaption></figure><p>When designing tests it is good to keep the ideas of making <em>action movies</em> in the back of your head.
Looking at some <em>the making of…​</em> can be quite instructive in this case.
For a scene to be taken, there is typically quite some preparation involved like hanging Spiderman
on a thin cable from the ceiling, making sure the <strong>crook</strong> is in the right position so he can land or receive the first punches and so on.<br>Then the director calls <strong>action</strong> and the scene is acted out<br>If the director is satisfied, all is okay<br>If not, he will want a redo later on.</p><p>A very popular style to write unit tests is the triple-A or <strong>Arrange-Act-Assert</strong>.</p><p><strong class=blue>Arrange</strong> simply means that you set up the objects you need in the tests:</p><div class=ulist><ul><li>The <strong>S</strong>ystem <strong>U</strong>nder <strong>T</strong>est, the <strong class=blue>SUT</strong> its the term in the testing world. In movies it is the protagonist or main actor.</li><li>The <strong>D</strong>ependent <strong>O</strong>n <strong>C</strong>omponents or <strong class=blue>DOC</strong>s, the scenario needs to play out the action. Supporting actors or even props in the movies.</li></ul></div><p><strong class=blue>Act</strong> is quite similar to a film directory shouting <strong>action</strong>, that is do what you prepared for.<br></p><div class=ulist><ul><li>This typically is one method call on the SUT.</li></ul></div><p><strong class=blue>Assert</strong> to test if the actual result of the action is what is expected.<br></p><div class=ulist><ul><li>The actual value can be the return value of the called method, but also the (new) state of the SUT.<br>In the movie: did the explosion happen, was the punch landed correctly
and was the emotion credible.</li></ul></div><figure class=listing-block><figcaption>AAA in action</figcaption><pre class=highlight><code class=language-java data-lang=java>@Test
public void shouldAllowToAddAddress() {
  // Arrange
  Client client = new Client();
  Address addressA = new Address(221b, &#34;Baker Street&#34;);

  // Act
  client.addAddress(addressA);

  // Assert
  assertThat( client.getAddresses() ).contains( addressA ));
}</code></pre></figure><p>Of course, Arrange, Act and Assert will vary with the actual business requirement, much
as the setup, play, and act in movie making. And also, quite similar to movie making
the arrange can be expensive or cheap, the action be fraught with risk or easy, and the assert can be complex or simple.</p><p>We hope to teach to keep all three <em>as simple as possible</em>, to keep the costs of testing so low that to make it never an argument to skip testing.</p><p>Later in this course we see some more complex scenarios, in which we need <a href=https://en.wikipedia.org/wiki/Extra_(acting)>Extras</a> as one would say in the movie industry.</p></section><section class="doc-section level-1"><h2 id=_clues_needed>Clues needed</h2><p>A smart person is able to avoid work. A common strategy is to let others do it. You can achieve such smartness your selves by using your tools properly.</p><p>For instance your IDE will gladly <em class=green>complete</em> code that your started by showing
a list of possible completions of the code that you already provided. However, the IDE
can only do that if you provide it with sufficient clues. For instance when you want the IDE
to generate a non-existing generic class, create two instance with different type parameters before your accept the hint to create class.</p><figure class=listing-block><figcaption>complete a generic</figcaption><pre class=highlight><code class=language-java data-lang=java>Box&lt;String&gt; sb= new Box&lt;String&gt;(); // compiler complains about nonexisting Box class.
Box&lt;Integer&gt; ib= new Box&lt;Integer&gt;(); // compiler complains about  nonexisting Box class.
// now you can let the IDE to follow its urge to do the typing for you.</code></pre></figure><p>The same applies to methods. If you want a specific return type, provide that in a declaration where you specify such type.</p><p>It also applies to frameworks such as AssertJ, that provides an <code>assertThat(…​)</code> method as entry for almost all asserts.
But what you put on the dots is important, because the IDE will inspect the <strong class=blue>type</strong> of the <em>expression</em> and then will look for the possible
completions. The completions for an Integer or int are very different from those for a <code>Collection</code> or <code>Iterable</code>.</p><p>Combine this with the previous tip. First you specify a variable with a type, that
uses the variable inside the <code>assertThat(…​)</code> and then the IDE will be able to find the possible completions.</p><p>Sometimes you have to nudge the IDE a bit, for instance when it suggest to create two constructors from the above example.
Accept one of the suggestions, but then <em>modify</em> the generated constructor to accept the type parameter of the class as input type of the constructor.
After saving all files, you will have convinced both IDE and compiler.</p><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><section class=paragraph><h6 class=block-title>It is good to have a thinking pause</h6><p>Let the IDE and framework do (most) of the typing work for you, by providing clues. If you do that smartly, it
will be easy to write code that is correct and acceptable by the compiler. A thinking pause can also useful
for the IDE, for it might need some processing first to find possible completions.
<strong class=big>Being lazy is good, both for code and smart people.</strong></p></section></aside></section><section class="doc-section level-1"><h2 id=_assertj_examples>AssertJ examples.</h2><p>In our course we to stick to <a href=https://assertj.github.io/doc/>AssertJ</a> library where possible.</p><p>The rationale for that is:</p><div class=ulist><ul><li>The AssertJ assertion API is very powerful and can easily turn overly strict or brittle tests into more effective tests.<br>You have come across tests in the mooc that insisted on specific formatting.
With AssertJ you can specify elements you want to see and do not want to see. See examples below.</li><li>AssertJ tests tend to be quite <strong>readable</strong>, once you get used to the fluent style. You will see long method names,
but they help understanding what is going on a no-brainer.</li><li>AssertJ can protect the test methods against unexpected exceptions, such as null pointers (NPE) before doing further tests.</li><li>With the exception of <em>testing exceptions</em>, the user interface and api of AssertJ is quite consistent.<br>You always start with <code>assertThat( objectOfInterest ).assertingMethod(…​)</code>.<br></li></ul></div><p>We try to use the latest stable version of AssertJ and Junit 5.</p><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>Either use <code>io.github.fontysvenlo:informaticspom</code> version 1.4 and up or add <code>assertj.core</code> to your test dependencies.</p></aside><section class="doc-section level-2"><h3 id=_simple_tests>Simple Tests</h3><figure class=listing-block><figcaption>test boolean value.</figcaption><pre class=highlight><code class=language-java data-lang=java>  car.start();
  assertThat( car.motorIsOn() ) <b class=conum>1</b>
      .as(&#34;Motor should be on after start&#34;) <b class=conum>2</b>
      .isTrue(); <b class=conum>3</b></code></pre><ol class="callout-list arabic"><li>Object of interest, return value of method, which in the test fails if not true.</li><li>Optional description, use in particular when testing primitive values such as boolean.<br>Use it to improved the information you get when the test fails.</li><li>The actual verification. Use <code>isTrue()</code> and <code>isFalse()</code> for <code>boolean</code>, <code>isEqualTo()</code> and <code>isEquals()</code> for other types.</li></ol></figure><figure class=listing-block><figcaption>Another SimpleTest</figcaption><pre class=highlight><code class=language-java data-lang=java>  assertThat(car.speedLimit())
      .as(&#34;Make it a legal car?&#34;)
      .isEqualTo(250);</code></pre></figure><figure class=listing-block><figcaption>Equals or same?</figcaption><pre class=highlight><code class=language-java data-lang=java>    assertThat( f1Champ ).isEqualTo( louis );
    assertThat( f1Champ ).isSameAs( louis );</code></pre></figure><p>Quiz: what is the difference between the two here: equals and same?</p><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>To follow along, tweak your IDE. Make sure you have the <a href=/prc2/pages/tips.html#_adding_your_own_code_templates_to_netbeans_ide>code template</a> to create a test method.
Note that the template adds a <strong>fail</strong> line, which should be disabled once the test and the business code agree.</p></aside></section><section class="doc-section level-2"><h3 id=_string_containment>String Containment</h3><figure class=listing-block><figcaption>test string containment</figcaption><pre class=highlight><code class=language-java data-lang=java>  Student student = ....

  assertThat( student.toString() )
      .isNotNull()                              <b class=conum>1</b>
      .doesNotContainIgnoringCase(&#34;student{&#34;)    <b class=conum>2</b>
      .contains( &#34;Harry&#34;, &#34;Potter&#34;, &#34;1980-07-31&#34;, &#34;12345&#34;); <b class=conum>3</b></code></pre><ol class="callout-list arabic"><li>Ensure that the next test can inspect a String without tripping over a NPE.</li><li><em>Auto generated is too simple.</em> Such autogenerated string typically starts with "Student{" for Java.</li><li>The test ensures that the birth date is contained, and 12345 is Harry’s student number.</li></ol></figure><p>How the string is formatted does not matter for this test to pass. It only requires the shown strings in any order.</p></section><section class="doc-section level-2"><h3 id=_collection_containment>Collection Containment</h3><p>For collections, there are numerous tests. Collections in this context include
everything <a href=https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Iterable.html>Iterable</a>,
making it very powerful as can be seen in the Javadoc page of Iterable
by following the link in this sentence. Look at the sub-interfaces and the implementing classes.</p><figure class=listing-block><figcaption>simple containment.</figcaption><pre class=highlight><code class=language-java data-lang=java>    List&lt;Professor&gt; professors = List.of( SNAPE, DUMBLEDORE, MCGONAGALL ); <b class=conum>1</b>

    List&lt;Professor&gt; teachesTransfiguration = professors.stream()
            .filter( p -&gt; p.teaches( &#34;Transfigurations&#34; ) ).collect( toList() );

    assertThat( teachesTransfiguration )
            .isNotNull()                         <b class=conum>2</b>
            .hasSizeGreaterThanOrEqualTo( 2 )    <b class=conum>3</b>
            .contains( DUMBLEDORE, MCGONAGALL ); <b class=conum>4</b></code></pre><ol class="callout-list arabic"><li>Assume this to be in the business code or SUT.</li><li>Not required but a good tip to make sure a test does not trip
over an NPE, which might be confusing.</li><li>The following <code>contains</code>-test makes this redundant</li><li>because we want these two at least.</li></ol></figure><div class=listing-block><pre class=highlight><code class=language-java data-lang=java>//  List&lt;Student&gt; hogwartsStudents = ...; <b class=conum>1</b>
  List&lt;Student&gt; hogwartsStudents = List.of( HARRY, HERMIONE, RON ); <b class=conum>1</b>

  assertThat( hogwartsStudents )
          .isNotNull()                                <b class=conum>2</b>
          .hasSizeGreaterThanOrEqualTo( 3 )           <b class=conum>3</b>
          .extracting( s -&gt; s.getStudentNumber() )    <b class=conum>4</b>
          .containsExactlyInAnyOrder( 12346, 12345, 12347 ); <b class=conum>5</b></code></pre><ol class="callout-list arabic"><li>Assume that the business code produces such a list.</li><li>Mostly self (test) protection.</li><li>Just to show that you can test for not empty, but also exact size, greater, etc. This assertion is made redundant by the test in 5.</li><li>Extract a feature out of each student using a lambda. Its function should be obvious.</li><li>Then test the list of extracted values for containment.</li></ol></div><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>Because adding a <strong>Non-Null</strong> test is easy and cheap in the fluent style of AssertJ,
it can be beneficial to always do that, so your test can show it as a failure instead of tripping over
an unexpected <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/NullPointerException.html>NPE</a>.
It more or less self-protects the test.</p></aside></section><section class="doc-section level-2"><h3 id=_assert_exceptions>Assert Exceptions</h3><p>In most business processes you want to avoid exceptions, but when they are expected,
they must be thrown by the code under test, so that too needs to be tested.</p><p>There are three cases:</p><div class="olist arabic"><ol class=arabic><li>You are not expecting an exception and do not (want to) care about it.<br>Then let it simply occur and if it is a checked exception make your test method throw it.</li><li>You want specific code <strong class=red>not</strong> to throw an exception and you want to test for that.<br>Wrap the suspect code in a lambda and invoke it using <code>assertThatCode( suspectCode )</code>.</li><li>You <strong class=green>want</strong> a specific exception to be thrown under specific a circumstance.<br>Wrap the exception-causing code in a lambda and catch and inspect the resulting exception using <code>assertThatThrownBy( causingCode )</code>.</li></ol></div><p>In AssertJ the exception testing helpers have a format that deviates from the <code>assertThat().someCheck(…​)</code> style.
This inconsistency has to do with the way the exceptions causing code must be called, and cannot easily be avoided.
We propagate one form, declaring a lambda first, and use that as the parameter to the exception asserter.</p><section class="doc-section level-3"><h4 id=_ignore_or_pass_on>Ignore or pass on</h4><p>In case you are not interested in an exception in your test, but it is a checked exception, simply declare your test method to throw it.</p><figure class=listing-block><figcaption>Case 1: not interested in the (checked) exception, add a throws clause.</figcaption><pre class=highlight><code class=language-java data-lang=java>    @Test
    public void fileUsingMethod() throws IOException { <b class=conum>1</b>
        Files.lines(Path.of (&#34;puk.txt&#34;) );  <b class=conum>2</b>
    }</code></pre><ol class="callout-list arabic"><li>This code potentially throws an <code>IOException</code>, but you are not interested in testing the exception. If it occurs,
let the caller (Test Runner) deal with this unexpected situation. The IOException is an example.</li><li>This is the method that throws the checked exception. This is an example. Normally it should be a business method.</li></ol></figure></section><section class="doc-section level-3"><h4 id=_exception_not_wanted>Exception NOT wanted.</h4><p>If you want the check for an exception NOT to occur when invoking a code sequence, isolate the sequence
in a lambda expression of the form <code>ThrowingCallable code =() → { suspectCode(); }</code>.<br>ThrowingCallable is a Functional interface and is part of AssertJ.</p><figure class=listing-block><figcaption>Case 2: the business code should explicitly NOT throw an exception.</figcaption><pre class=highlight><code class=language-java data-lang=java>    Student draco = new Student(&#34;Draco&#34;, &#34;Malfoy&#34;, LocalDate.of (1980,6,5));
    ThrowingCallable code = () -&gt; {
        hogwarts.addStudent( draco );  <b class=conum>1</b>
    };

    assertThatCode( code)
            .as( &#34;draco should be accepted to make the adventures possible&#34;)
            .doesNotThrowAnyException();</code></pre><ol class="callout-list arabic"><li>Is the only code that is checked for exceptions. This isolates the "suspect" code from
any other code that may cause issues.</li></ol></figure><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>Sometimes you may have the situation that exceptions appear to come out of the blue, as in you have
no idea what causes it and the stack trace is not very helpful either. In such cases, use this test method
to isolate the problematic code.</p></aside></section><section class="doc-section level-3"><h4 id=_exception_needs_to_occur>Exception needs to occur.</h4><p>When you want your business code to throw an exception, wrap that business code (the method invocations) in a lambda expression,
in the same way as in the previous paragraph, then pass that <code>code</code> to the exception assert method.</p><figure class=listing-block><figcaption>Catch a specific exception.</figcaption><pre class=highlight><code class=language-java data-lang=java>    @Test
    public void addIllegalProfessor() {
        var malfoy = new Professor( &#34;Lucius&#34;, &#34;Malfoy&#34;, LocalDate.of( 1953, 10, 9 ) ); <b class=conum>1</b>

        ThrowingCallable code = () -&gt; { <b class=conum>2</b>
            hogwarts.addProfessor( malfoy );
        };

        assertThatThrownBy( code )
                .isInstanceOf( Exception.class) <b class=conum>3</b>
                .isExactlyInstanceOf( IllegalArgumentException.class) <b class=conum>4</b>
                .hasMessageContainingAll( &#34;should&#34;,&#34;teach&#34;); <b class=conum>5</b>
        // fail( &#34;addIllegalProfessor completed successfully; you know what to do&#34; );
    }</code></pre><ol class="callout-list arabic"><li>Someone who knows his classics understands that this crook can’t be a professor at Hogwarts.</li><li>The lambda defines the throwing code. <code>org.assertj.core.api.ThrowableAssert.ThrowingCallable</code> is the functional interface for this purpose.</li><li>Sometimes it is good to be a bit relaxed on the exception type like in this line.</li><li>Or you need to be quite specific. You need only one, so choose either line 2 or 3. This is just an illustration.</li><li>You might want to inspect the message for keywords.</li></ol></figure><p>In this fluent style, you can check many more things. See the <a href=https://assertj.github.io/doc/>AssertJ user guide</a>
and <a href=https://javadoc.io/doc/org.assertj/assertj-core/latest/index.html>API</a> for that.</p><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>The general advice is to have only one (1) assert per test method. This makes the test method very focused.
Stick to this rule and do not test unrelated features.
Also note that when a failure occurs (a test fails or an exception is thrown), the rest of the test is not executed anymore,
and this will therefore obscure further asserts in the same test method.</p></aside></section></section></section><section class="doc-section level-1"><h2 id=_soft_assertions>Soft Assertions</h2><p>Sometimes you have a pressing need to assert more than one thing in a test method,
because two or more values always come in pairs and setting stuff up and dividing it over multiple
methods would make the test less readable, which is bad.</p><p>However, having multiple asserts in one method is bad style, because
the first problem that occurs is the only failure that will be reported by the test. You could say that the first
failure dominates or monopolizes the test method.</p><p>However the rule above makes writing tests a bit awkward. In particular when there are multiple aspects to be tested on the
same result object. In that case a soft assertion may be helpful.
A soft assertion will fail "softly", meaning that the failure is recorded, but the test can still continue to verify another aspect.
The soft assertion will collect all failures and will report them after the soft assertion is <strong>closed</strong>.</p><figure class=listing-block><figcaption>soft assertion, testing both key and value of a KeyValue object.</figcaption><pre class=highlight><code class=language-java data-lang=java>   void testGetResult(){
    // some setup
    Optional&lt;KeyValue&lt;Integer,Double&gt;&gt; = new gf(student).gradeFor(&#34;PRC2&#34;);
    SoftAssertions.assertSoftly( softly -&gt; { <b class=conum>1</b>
                AbstractMap.SimpleEntry&lt;Integer, Double&gt; result = gf.getResult();
                softly.assertThat( result )
                    .extracting( &#34;key&#34; )
                    .isEqualTo( student.getStudentId() );
                softly.assertThat( result )
                    .extracting( &#34;value&#34; )
                    .isEqualTo( grade );
    }); <b class=conum>2</b>
  }</code></pre><ol class="callout-list arabic"><li>Starts the lambda that encloses the soft assertions. <strong>Softly</strong> serves as the collector of the failures</li><li>Closes the sequence of soft assertions. This is the spot where SoftAssertion will report the the failures, if any.</li></ol></figure><p>In the example, the key and value in the KeyValue pair are related, making a soft assertion applicable.</p></section><section class="doc-section level-1"><h2 id=_assumptions>Assumptions</h2><p>There are test cases that are only useful under certain conditions:</p><div class=ulist><ul><li>The test is only meaningful on a specific Operating System.</li><li>The test needs a database connection and only executes when available.</li><li>A file must be present.</li><li>A 'slow' test flag is set in some file, which only executes the test when that flag is set.
Used to avoid slow tests in the normal write-compile-test cycle.</li></ul></div><p>For this you can use <strong>Assume</strong>.</p><p>There are two variants relevant:</p><div class=ulist><ul><li>the <a href=https://junit.org/junit5/docs/current/user-guide/#writing-tests-assumptions>JUnit5 style Assumptions</a></li><li>The <a href=https://assertj.github.io/doc/#assertj-core-assumptions>Assert-J flavor Assumptions</a></li></ul></div><p>You can use the Assumption test in the setup methods (the one with <code>@BeforeXXX</code>), to completely disable all tests in one test class,
instead of having each test doing the <code>assumeXXX</code> test. A test that has been canceled because of a failing assumption will
appear as a skipped test, similar to a disabled test with <code>@Disabled</code>.</p><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>If you want to disable a whole test class, Do the assumption in a @BeforeAll annotated static setupClass() method.</p></aside><p>The JUnit 5 Assumptions are effective, but can only test for true or false, so you need to
feed it a boolean expression. Look at the <a href=https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/Assumptions.html target=_blank rel=noopener>API</a> to see all features.
But simple may be just perfect here.</p><figure class=listing-block><figcaption>Disable on staging machine. From JUnit 5 user guide.</figcaption><pre class=highlight><code class=language-java data-lang=java>    @Test
    void testOnlyOnDeveloperWorkstation() {
        assumeTrue(&#34;DEV&#34;.equals(System.getenv(&#34;ENV&#34;)), &#34;Aborting test: not on developer workstation&#34;);
        // remainder of test is only executed if on developer machine
    }</code></pre></figure><p>You guessed it, AssertJ Assumptions are richer. In most cases,
the assumption has the same form as an assert that, as in replace <strong>assert</strong> with <strong>assume</strong> and you are done.
So any <code>assertThat(…​)</code> that you already have can simply be turned into an <code>assumeThat(…​)</code>.</p><p>If nothing else, using assertj may make your tests more readable and have a consistent look and feel.</p><figure class=listing-block><figcaption>Disable test if file does not exists</figcaption><pre class=highlight><code class=language-java data-lang=java>    File f = new File(Path.of(&#34;testData.dat&#34;));
    assumeThat(f)
       .as(&#34;Test data file not available, skipping test&#34;)
       .exists();</code></pre></figure></section><section class="doc-section level-1"><h2 id=_additional_pointers>Additional pointers</h2><div class=ulist><ul><li><a href=https://assertj.github.io/doc/ target=_blank rel=noopener>AssertJ - fluent assertions java library</a></li><li><a href=https://junit.org/junit5/docs/current/user-guide/ target=_blank rel=noopener>JUnit 5 User Guide</a></li></ul></div><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>Check out <a href=https://assertj.github.io/doc/#assertj-core-assertions-guide>this guide on assertions with AssertJ</a>!</p></aside></section><section class="doc-section level-1"><h2 id=_clean_tests>Clean tests</h2><p>Bad tests are anything but a pleasure to work with. They are slow, hard to understand, and hard to maintain.
In order to write clean tests, we follow the F.I.R.S.T. principles of tests:</p><div class=ulist><ul><li><strong>Fast</strong>: Tests should run quickly.</li><li><strong>Independent</strong>: Tests should not depend on each other. When the state of one test affects the outcome of another, it can be hard to understand why a test fails and makes it harder to run single tests or run tests in parallel.</li><li><strong>Repeatable</strong>: Tests should be repeatable in any environment. This means that tests should not depend on external resources like databases, network, or file systems.</li><li><strong>Self-Validating</strong>: Tests should be able to determine if they pass or fail without human intervention. This means that the test should contain assertions that determine if the test passes or fails.</li><li><strong>Timely</strong>: Tests should be written before the code they test. This is the essence of Test-Driven Development (TDD). If you write tests after the code, you might find out the code is hard to test.</li></ul></div></section><section class="doc-section level-1"><h2 id=_parameterized_tests>Parameterized tests</h2><p><span class=big>You will often see that test methods look a lot like each other. As an example:
In the fraction exercise, in most test methods you have two inputs and one or two results,
then an operation is done followed by some assertion, often of the same kind.
This quickly leads to the habit of <em>copy and waste</em> programming. Many errors are introduced this way: You copy the original,
tweak the copy a bit and you are done. Then you forget one required tweak, because they are easy to miss, but you do not notice it until too late.</span></p><section class="admonition-block warning" role=doc-notice><h6 class="block-title label-only"><span class=title-label>Warning:</span></h6><figure class="image-block related thumb right"><img src=/prc2/images/waste.jpg alt=waste width=480><figcaption>Figure 5. Do not become a ctrl+c, ctrl+v junky. That only produces junk.</figcaption></figure><p>Avoid <em class=big>copy and waste</em> at almost all times. It is <strong class="big red">NOT</strong> a good programming style. If you see it in your code, refactor it to
remove the copies, but instead make calls to one version of it. This will make you have <em>less</em> code overall. Coding excellence is never measured
in number of code lines, but in quality of the code. Think of gems. They are precious because they are rare.</p><p>The <em>copy and waste</em> problem can even become worse: When the original has a flaw, you are just multiplying the
number of flaws in your code. This observation applies to test code just as well.<br></p><p><strong>CODE THAT ISN’T WRITTEN CAN’T BE WRONG</strong>.</p></section><section class="doc-section level-2"><h3 id=_parameterized_test_junit_5_style>Parameterized test, Junit 5 style</h3><p>Below you see an example on how you can condense the <code>toString()</code> tests of fraction from 5 very similar test methods into 5 strings containing the test data
and 1 (say one) test method.<br>Paraphrasing a saying: <em class="green big">Killing many bugs with one test</em>.</p><figure class=listing-block><figcaption>Complete fraction test class with parameterized test, using an in-code csv source</figcaption><pre class=highlight><code class=language-java data-lang=java>package fraction;

import static org.assertj.core.api.Assertions.assertThat;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.aggregator.ArgumentsAccessor;
import org.junit.jupiter.params.provider.CsvSource;

public class FractionCSVSourceTest {

    @ParameterizedTest
    @CsvSource( {
           //&#34;message,          expected,     n,   d&#34;, <b class=conum>1</b>
           &#34;&#39;two thirds&#39;,        &#39;(2/3)&#39;,     2,   3&#34;, <b class=conum>2</b>
           &#34;&#39;whole number,           &#39;2&#39;,     2,   1&#34;,
           &#34;&#39;one third&#39;,         &#39;(1/3)&#39;,    -3,  -9&#34;,
           &#34;&#39;minus two fifths&#39;,  &#39;(-2/5)&#39;,   12, -30&#34;,
           &#34;&#39;one + two fifths&#39;, &#39;(-1-(2/5))&#39;,   35, -25&#34;
    } )
    void fractionOps( String message, String expectedString,
            int numerator, int denominator ) { <b class=conum>3</b>

        Fraction f = new Fraction( numerator, denominator );
        assertThat( f.toString() )
                .as( message )
                .isEqualTo( expectedString );
    }
}</code></pre><ol class="callout-list arabic"><li>Adding a comment is always a good idea. You may also want your values aligned for improved readability.</li><li>Parameters are separated by commas, which maybe in the test values. In that case you can demarcate Strings with single quotes inside the csv record string.
If you need another separator instead of comma, you can specify that too,
see <a href=https://junit.org/junit5/docs/current/api/org.junit.jupiter.params/org/junit/jupiter/params/provider/CsvSource.html target=_blank rel=noopener>CsvSource API </a>.</li><li>The parameters are passed in as the type(s) provided by the test method’s signature. The Junit-5 framework will (try to) parse the csv record elements accordingly.</li></ol></figure><p>For more details see <a href=https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests target=_blank rel=noopener>Junit 5 parameterized tests </a>.</p><p>The CsvSource version of parameterized test is the simplest to use and easily understood.
It keeps data and the test together, nicely near to each other, so it make it easy to read the
tests and data in one glance.
They typically fit easily on a screen. Remember the importance of readability of code. That too applies to test code.</p><hr></section><section class="doc-section level-2"><h3 id=_lookup_in_a_map>Lookup in a map.</h3><p>Sometimes there is no easy way to get from a string to some object, or even class.
Examples are that you want to test for the correct <strong>type</strong> or <strong>exception</strong>, or supply a method name, but you cannot put that into a string without doing complex
things like reflection which we may only do in later parts of the course. The trick is to use a <code>Map</code> that maps a string to the object of choice.</p><p>The lookup trick might also be applicable when you want to have short values in your test data table, like a message number which is mapped
to the actual longer expected message, or even a message that is a format string and can be used in <code>Assertion.as( formatString, Object…​ args)</code>.</p><figure class=listing-block><figcaption>map from short string to test (Person) object.</figcaption><pre class=highlight><code class=language-java data-lang=java>static Map&lt;String, Person&gt; emap = Map.of(
    &#34;piet&#34;, new Person(&#34;Piet&#34;, &#34;Puk&#34;, LocalDate.of(1955-03-18),&#34;M&#34;),
    // piet2 for equals test.
    &#34;piet2&#34;, new Person(&#34;Piet&#34;, &#34;Puk&#34;, LocalDate.of(1955-03-18),&#34;M&#34;),
    &#34;rembrandt&#34;, new Person(&#34;Rembrandt&#34;, &#34;van Rijn&#34;, LocalDate.of(1606,7,15),&#34;M&#34;),
    &#34;saskia&#34;, new Person(&#34;Saskia&#34;, &#34;van Uylenburgh&#34;, LocalDate.of(1612,8,11),&#34;F&#34;),
  );</code></pre></figure><p>It is particularly applicable to lambda expressions.
You can translate a string into a lambda, by using a map. You can then use simple names (strings),
that can be put in a csv record.</p><figure class=listing-block><figcaption>Map of string to lambda</figcaption><pre class=highlight><code class=language-java data-lang=java>    final Map&lt;String, BiFunction&lt;Fraction, Fraction, Fraction&gt;&gt; ops = <b class=conum>1</b>
      Map.of(
              &#34;times&#34;, ( f1, f2 ) -&gt; f1.times( f2 ),
              &#34;plus&#34;, ( f1, f2 ) -&gt; f1.plus( f2 ),
              &#34;flip&#34;, ( f1, f2 ) -&gt; f1.flip(), <b class=conum>2</b>
              &#34;minus&#34;, ( f1, f2 ) -&gt; f1.minus( f2 ),
              &#34;divideBy&#34;, ( f1, f2 ) -&gt; f1.divideBy( f2 )
      );</code></pre><ol class="callout-list arabic"><li>Note that we use a <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/function/BiFunction.html>BiFunction&lt;T,U,R></a> existing functional interface,
with <strong>T</strong>, <strong>U</strong>, and <strong>R</strong> all of the same type: Fraction. This is legal.</li><li>f2 is not used in the right hand side of the arrow. This is legal too.</li></ol></figure><figure class=listing-block><figcaption>Using lambda names in test data</figcaption><pre class=highlight><code class=language-java data-lang=java>@ParameterizedTest
@CsvSource(
    {
    &#34;&#39;one half times one third is 1 sixth&#39;, &#39;times&#39;, &#39;(1/6)&#39;,1,2,1,3&#34;, <b class=conum>1</b>
    &#34;&#39;one thirds plus two thirds is 1&#39;    , &#39;plus&#39;,      &#39;1&#39;,1,3,2,3&#34;,
    &#34;&#39;flip&#39;                               , &#39;flip&#39;,      &#39;3&#39;,1,3,1,3&#34;, <b class=conum>2</b>
    &#34;&#39;one half minus two thirds is&#39;       , &#39;minus&#39;, &#39;(-1/6)&#39;,1,2,2,3&#34;
  } )</code></pre><ol class="callout-list arabic"><li>The operation name is the second value in the csv record, here <strong>times</strong>. Note that you can quote strings, but that is not required.</li><li>In the flip operation, the second fraction is ignored, so any legal value is allowed. Here we use the same values for both fractions.</li></ol></figure><figure class=listing-block><figcaption>Test method using the test data (Annotations left out, they are above).</figcaption><pre class=highlight><code class=language-java data-lang=java>void fractionOps( String message, String opName, String expected,
              int a,int b, int c, int d ) { <b class=conum>1</b>
    // Arrange: read test values
    Fraction f1 = frac( a, b ); <b class=conum>2</b>
    Fraction f2 = frac( c, d );
    BiFunction&lt;Fraction, Fraction, Fraction&gt; op = ops.get( opName ); <b class=conum>3</b>

    // Act
    Fraction result = op.apply( f1, f2 ); <b class=conum>4</b>

    // Assert(That) left out as exercise.
    // Use assertThat on the fraction object result
    //   and check if it has the correct string value.
    // Use the message in the as(...) method.

}</code></pre><ol class="callout-list arabic"><li>The fraction parameters a,b,c, and d are captured from the csvrecord. This makes the parameter list a
tad longer, but also more understandable. JUnit 5 csvsource uses the annotation and the signature of the test method and can deal
with most common types such as primitive, String and LocalDate (preferably in ISO-8601 format such as '2021-01-14' for the day of writing this). Strings in the csv-records will be automatically converted to the parameter types in your test methods in these cases.</li><li>The fraction instances are created from a, b, c, and d.</li><li>The operation (op) is looked up in the map.</li><li>Apply the operation, or rather the function and capture the result.</li></ol></figure><p>You can apply the same trick of looking up with enums too, even easier, because the enum itself can translate from String to value,
as long as the spelling is exact that is minding upper and lower case usage.</p><p>Study the examples above, they might give you inspiration with the exercises coming up and will score you points during the exam.</p><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>As of the moment of writing (January 2021, Junit 5.7), the parameterized test <strong class=red>can’t</strong> deal with varargs parameters, that is a varying
list of parameters, with the triple dot notation.</p></aside></section><section class="doc-section level-2"><h3 id=_test_data_from_a_file>Test data from a file</h3><p>Sometimes the amount of data you have in your test data-set is so big that it does not comfortably fit inside a <code>@CsvSource</code> annotation.
You specify an external file as data source with to achieve the same, the annotation now is <code>@CsvFileSource</code>, which takes files as argument.</p><p>The file, as you might have guessed, can be a csv file, which can be edited quite comfortably with a <a href="https://plugins.netbeans.apache.org/catalogue/?id=1">NetBeans plugin</a>
or with the help of a spreadsheet program like Libreoffice calc or Microsoft excel.</p><p>Suppose you need to develop an input validator that has many test cases. Putting the inputs in a file along with other information relevant
to your validator.</p><figure class=listing-block><figcaption>csvfile source</figcaption><pre class=highlight><code class=language-java data-lang=java>  @ParameterizedTest
  @CsvFileSource( resources = { &#34;testdata.csv&#34; } )
  void testRegex( String message, String input,
          boolean matches, int groupCount ){
    // your code here
  }</code></pre></figure><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>At the time of writing JUnit wants the csv file for CsvFileSource to be
in the <code>{project-directory}src/test/resources</code> folder or a child folder thereof.
To be able to do that, you <strong>first</strong> need to create that folder.</p></aside></section><section class="doc-section level-2"><h3 id=_repeated_use_of_same_data>Repeated use of same data.</h3><p>In some cases, multiple tests need the same data. In the case of a CsvSourceFile, that is easily covered: Simple copy the annotations to all places where you need
them. This is an <em>acceptable form</em> of copy and waste, because the annotations all point to one source of truth, the CSV file.</p><p>Sometimes you would like to keep or even generate the test data inside the test class.
Do not take the simple and naive route to simply copy-and-waste the (largish) csvsource data,
but instead stick to the <a href=https://en.wikipedia.org/wiki/Don%27t_repeat_yourself>D.R.Y. rule</a>.</p><p>One problem is that a method in Java can return only one result, either object or primitive type. Luckily
an array is also an object in Java.</p><p>There are two solutions to this issue.</p><div class="olist arabic"><ol class=arabic><li>Create special test data objects of a special test data class, either inside your or outside your test class
easy to make a test data class to carry the test data. In this case make a data providing method and use the method name in the <code>@MethodSource</code> annotation.
The test method should understand the test data object.</li><li>Use the JUnit5 provided <code>ArgumentsProvider</code>. This wraps an array of objects into one object, so that all can be returned as one (array) value in a stream.<br>This saves the implementation of a (simple) test data class.</li></ol></div><p>Have a look at the <a href=https://junit.org/junit5/docs/current/user-guide/>JUnit5 documentation</a> to find a further explanation and examples.</p><hr><p>Because we are collecting test tricks, here is another one:</p></section></section><section class="doc-section level-1"><h2 id=_test_recipe_i_test_equals_and_hashcode>Test Recipe I, Test Equals and hashCode</h2><p>We may sprinkle our testing stuff with a few recipes for often occurring tests.
This is the the first installment.</p><p><strong>Equals</strong> and <strong>hashCode</strong> are not twins in the direct sense, but indeed methods whose implementation should
have a very direct connection.
From the java <a href=https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#hashCode() target=_blank rel=noopener>Object API</a> follows
that:</p><div class=ulist><ul><li>Two objects that are equal by their equal method, than their hashCode should also be equal.</li><li>Note that the reverse is not true. If two hashCode are the same, that does not imply that the objects are equal.</li><li>A good hashCode 'spreads' the objects well, but this is not a very strict requirement or a requirement that can be enforced. A poor hashCode
will lead to poor Hash{Map|Set} lookup performance.</li></ul></div><p>Although hashCodes are invented to speedup finding object in a hash map or hash set, these collections use hashCode in the first part of the search,
but must verify equality as final step(s).</p><p>The thing is that the equals method must consider quite a few things, expressed with conditional evaluation (if-then-else).
The good thing is an IDE typically provides a way to generate equals and hashCode for you and these implementations are typically of good quality. But in particular in the equals method there are quite some ifs, sometimes in disguise, coded as <code>&&</code>, so this will throw some flies in your code-coverage ointment.</p><p>However, we can balance this generated code by a piece of reusable test code, that can be used for almost all cases.
In fact we have not found a case where it does not apply.<br>Let us first explain the usage and then the implementation.<br>Suppose you have an object with three fields, <code>name</code>, <code>birthDate</code> and <code>id</code>. All these fields should be considered in equals and hashCode.<br>As an exercise, create such and object now in your IDE, call it Student, why not.</p><div class=listing-block><pre class=highlight><code class=language-java data-lang=java>class Student {
  final String name;
  final LocalDate birthDate;
  final int id;
}</code></pre></div><p>From the above, the IDE can generate a <strong>constructor</strong>, <strong>equals</strong> and <strong>hashCode</strong> and <strong>toString</strong>. What are you waiting for? Because it is not test driven?
You would be almost right, but why test drive something that can be generated.<br>However, if your spec does <strong class=red>not</strong> demand equals and hashCode,
then <strong class="red big">do not write/generate</strong> them. That would be unwanted code. But if the requirements DO insist on equals and hashCode,
make sure that the fields to be considered match the requirements. Choose only final fields.</p><p>After having such a generated equals and hashCode you have the predicament of writing a test. HashCode is relatively easy. It should produce an
integer, but what value is unspecified, so just invoking it would do the trick for test coverage.
The devil is in the equals details, because it has to consider:</p><div class=ulist><ul><li>Is the other object <code>this</code>? If yes, return <code>true</code>.</li><li>Is the other object <code>null</code>? Return <code>false</code> if it is.</li><li>Now consider the type.<a class=footnote-ref id=_footnoteref_1 href=#_footnote_1 title="View footnote 1" role=doc-noteref>[1]</a>.<ul><li>Is the other of the same type as <code>this</code>? If not return <code>false</code>.</li><li>Now we are in known terrain, the other is of the same type, so the object should have the same fields.<br>For each <code>field</code> test it <code>this.field.equals(other.field)</code>. If not return false.</li><li>Using <code>Objects.equals(this.fieldA, other.fieldA)</code> can be an efficient solution to avoid testing for nullity of either field.</li></ul></li></ul></div><figure class=listing-block><figcaption>Generated equals. It is fine.</figcaption><pre class=highlight><code class=language-java data-lang=java>@Override
public boolean equals( Object obj ) {
    if ( this == obj ) {
        return true;
    }
    if ( obj == null ) {
        return false;
    }
    if ( getClass() != obj.getClass() ) {
        return false;
    }
    final Student other = (Student) obj;
    if ( this.id != other.id ) {
        return false;
    }
    if ( !Objects.equals( this.name, other.name ) ) {
        return false;
    }
    return Objects.equals( this.birthDate, other.birthDate );
}</code></pre></figure><p>You see a pattern here: The number of ifs is 3 + the number of fields.<br>To test this, and to make sure you hit all code paths, you need to test with this,
with null, with an distinct (read newly constructed) object with all fields equal,
and then one for each field, which differs from the reference object only in said field.</p><p>Define those instances (for this example) as follows.</p><figure class=listing-block><figcaption>Instances for complete equals and hashCode test and coverage</figcaption><pre class=highlight><code class=language-java data-lang=java>//@Disabled
@Test
void testEqualsAndHash() {
    Student ref = new Student( &#34;Jan&#34;, LocalDate.of( 1999, 03, 23 ), 123 ); <b class=conum>1</b>
    Student equ = new Student( &#34;Jan&#34;, LocalDate.of( 1999, 03, 23 ), 123 ); <b class=conum>2</b>
    Student sna = new Student( &#34;Jen&#34;, LocalDate.of( 1999, 03, 23 ), 123 ); <b class=conum>3</b>
    Student sda = new Student( &#34;Jan&#34;, LocalDate.of( 1998, 03, 23 ), 123 ); <b class=conum>4</b>
    Student sid = new Student( &#34;Jan&#34;, LocalDate.of( 1999, 03, 23 ), 456 ); <b class=conum>5</b>
    verifyEqualsAndHashCode( ref, equ, sna, sda, sid );
    //fail( &#34;testMethod reached it&#39;s and. You will know what to do.&#34; );
}</code></pre><ol class="callout-list arabic"><li>The reference object</li><li>The equal object, equals true</li><li>Differs in name.</li><li>Differs in birth date (year).</li><li>Differs in id.</li></ol></figure><p>The implementation of the <code>verifyEqualsAndHashCode</code> has been done with generics and a dash of AssertJ stuff.</p><figure class=listing-block><figcaption>Sample test helper in separate class.</figcaption><pre class=highlight><code class=language-java data-lang=java>/**
 * Helper for equals tests, which are tedious to get completely covered.
 *
 * @param &lt;T&gt; type of class to test
 * @param ref reference value
 * @param equal one that should test equals true
 * @param unEqual list of elements that should test unequal in all cases.
 */
public static &lt;T&gt; void verifyEqualsAndHashCode( T ref, T equal, T... unEqual ) {
    Object object = &#34;Hello&#34;;
    T tnull = null;
    String cname = ref.getClass().getCanonicalName();
    // I got bitten here, assertJ equalTo does not invoke equals on the
    // object when ref and &#39;other&#39; are same.
    // THAT&#39;s why the first ones differ from the rest.
    SoftAssertions.assertSoftly( softly-&gt; {
    softly.assertThat( ref.equals( ref ) )
            .as( cname + &#34;.equals(this): with self should produce true&#34; )
            .isTrue();
    softly.assertThat( ref.equals( tnull ) )
            .as( cname + &#34;.equals(null): ref object &#34;
                    + safeToString( ref ) + &#34; and null should produce false&#34;
            )
            .isFalse();
    softly.assertThat( ref.equals( object ) )
            .as( cname + &#34;.equals(new Object()): ref object&#34;
                    + &#34; compared to other type should produce false&#34;
            )
            .isFalse();
    softly.assertThat( ref.equals( equal ) )
            .as( cname + &#34; ref object [&#34; + safeToString( ref )
                    + &#34;] and equal object [&#34; + safeToString( equal )
                    + &#34;] should report equal&#34;
            )
            .isTrue();
    for ( int i = 0; i &lt; unEqual.length; i++ ) {
        T ueq = unEqual[ i ];
        softly.assertThat( ref )
                .as(&#34;testing supposed unequal objects&#34;)
        .isNotEqualTo( ueq );
    }
    // ref and equal should have same hashCode
    softly.assertThat( ref.hashCode() )
            .as( cname + &#34; equal objects &#34;
                    + ref.toString() + &#34; and &#34;
                    + equal.toString() + &#34; should have same hashcode&#34;
            )
            .isEqualTo( equal.hashCode() );
});
}</code></pre></figure><p>The above code has been used before but now adapted for AssertJ and JUnit 5.</p><p>It is of course best to put this in some kind of test helper library, so you can reuse it over and over without having to
resort to copy and waste.</p><hr><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>Think test driven! So write tests FIRST, and then code. Testing is ensuring that the code is usable.
To make code testable is also a design exercise: you need to make decisions about the design of your program when you write your tests. If you have no idea how to test it,
you are equally clueless about how to use the designed classes.</p></aside></section><section class="doc-section level-1"><h2 id=_links>Links</h2><div class=ulist><ul><li><a href=https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests target=_blank rel=noopener>JUnit 5 Parameterized Tests</a></li><li><a href=https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests-sources-CsvSource target=_blank rel=noopener>CSV Source Tests</a></li><li><a href=https://www.baeldung.com/parameterized-tests-junit-5 target=_blank rel=noopener>Baeldung on Parameterized Tests with JUnit 5</a></li></ul></div></section><section class=footnotes aria-label=Footnotes role=doc-endnotes><hr><ol class=footnotes><li class=footnote id=_footnote_1 role=doc-endnote>Not all equals implementation look at the type of this, See the java.util.List doc for a counter example <a class=footnote-backref href=#_footnoteref_1 role=doc-backlink title="Jump to the first occurrence in the text">↩</a></li></ol></section></article></div><footer class="text-sm leading-6 mt-12 mb-5">Theme provided by <a class="text-pink-500 underline" href=https://github.com/FontysVenlo/sebi-theme target=_blank>SeBi Venlo</a></footer><div class="fixed z-20 top-[3.8125rem] bottom-0 right-[max(0px,calc(50%-45rem))] w-[19.5rem] py-10 px-8 overflow-y-auto hidden xl:block"><h5 id=toc-header class="text-slate-900 font-semibold mb-4 text-sm leading-6 dark:text-slate-200">On this page</h5></div></div><div class="hidden lg:hidden fixed inset-0 z-10 bg-gray-900/50 dark:bg-gray-900/60" id=menu-backdrop></div></div><script src=/prc2/js/main.min.956966b3103878d329f9460daf829f6ad1d50fc9e24d20ff0c5d93a4006065df877564edc24b6a2a5182bf4387d13d9f960a1df6fc9d259d38cfb8e83509c999.js integrity="sha512-lWlmsxA4eNMp+UYNr4KfatHVD8niTSD/DF2TpABgZd+HdWTtwktqKlGCv0OH0T2flgod9vydJZ04z7joNQnJmQ==" crossorigin=anonymous></script>
<script src=/prc2/js/highlight.min.cd8091de05577194483fff730f723dc2379226a640ef117b33ad133cc3da2f690d95af8fc32186b11dc10628e66e325b33bee2bf443c98315905e50f22aecc50.js integrity="sha512-zYCR3gVXcZRIP/9zD3I9wjeSJqZA7xF7M60TPMPaL2kNla+PwyGGsR3BBijmbjJbM77iv0Q8mDFZBeUPIq7MUA==" crossorigin=anonymous defer></script><div id=copied-alert class="invisible opacity-0 transition-all ease-in-out duration-400 fixed bottom-3 right-10 z-50 flex p-4 mb-4 text-sm text-gray-800 bg-gray-200 rounded-lg dark:bg-gray-500 dark:text-gray-200" role=alert><svg class="inline flex-shrink-0 mr-3 w-5 h-5" viewBox="0 0 24 24" width="24" height="24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg><div><span class=font-medium>Code copied</span></div></div></body></html>