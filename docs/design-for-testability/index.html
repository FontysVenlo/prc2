<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>PRC2 - 03 Design for testability</title><link rel=stylesheet href=https://fontysvenlo.github.io/prc2/css/main.min.bd363a626ae1c698f13409c9784ea6f1475d32782da4f7940f5ad0410559be2b5eefe173b448f56944635de717743c3d4c0bc6b77f7029d9a73502f96b089860.css integrity="sha512-vTY6YmrhxpjxNAnJeE6m8UddMngtpPeUD1rQQQVZvite7+FztEj1aURjXecXdDw9TAvGt39wKdmnNQL5awiYYA==" crossorigin=anonymous><link rel=stylesheet href=https://fontysvenlo.github.io/prc2/css/highlight.9e5322c61da2ab0997ce2db01648537ffacdb7b808fc24af4d99ff51257c59db9500031551feb8e62cafde7a246ae2c0015c2862637519a22eb0b49fa7b9d2f9.css integrity="sha512-nlMixh2iqwmXzi2wFkhTf/rNt7gI/CSvTZn/USV8WduVAAMVUf645iyv3nokauLAAVwoYmN1GaIusLSfp7nS+Q==" crossorigin=anonymous><link rel=stylesheet href=https://fontysvenlo.github.io/prc2/css/fontawesome.18a15c01c2df9b660114c44bfe1cd143dc48faeea9d5bc11a5b70509d8ec85ae65ac4c6dab72eb09a5c4770d45d6a2d802d28924e739d852a37c1b14f3a9cc61.css integrity="sha512-GKFcAcLfm2YBFMRL/hzRQ9xI+u6p1bwRpbcFCdjsha5lrExtq3LrCaXEdw1F1qLYAtKJJOc52FKjfBsU86nMYQ==" crossorigin=anonymous><script src=/prc2/js/init-darkmode.min.b7911813658cd032d0ed2d118da1fb57653d18386d8b1a26618f83f80019be21e977a1ddeeaeb51dcd1f7d21dfed542a8da077c29eb1ec03d84471bf90d3fabe.js integrity="sha512-t5EYE2WM0DLQ7S0RjaH7V2U9GDhtixomYY+D+AAZviHpd6Hd7q61Hc0ffSHf7VQqjaB3wp6x7APYRHG/kNP6vg==" crossorigin=anonymous></script>
<link rel=apple-touch-icon sizes=180x180 href=https://fontysvenlo.github.io/prc2/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://fontysvenlo.github.io/prc2/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://fontysvenlo.github.io/prc2/favicon-16x16.png></head><body class="antialiased text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800"><header class="sticky top-0 z-40 w-full flex-none lg:border-b lg:border-gray-900/10 dark:border-gray-50/[0.06] bg-white dark:bg-gray-800
border-b border-slate-900/10 lg:border-0 dark:border-slate-300/10"><div class="max-w-8xl mx-auto"><div class="py-4 lg:px-8 mx-4 lg:mx-0"><div class="relative flex items-center"><button id=menu-toggle type=button class="lg:hidden text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 mr-3">
<span class=sr-only>Navigation</span><svg viewBox="0 0 24 24" width="20" height="20" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
<a class="mr-3 flex-none overflow-hidden md:w-auto dark:hover:text-gray-200 hover:text-gray-900" href=https://fontysvenlo.github.io/prc2/>PRC2</a><div class="relative flex ml-auto"><nav class="hidden md:flex items-center text-sm leading-6 font-semibold text-gray-700 dark:text-gray-200"><ul class="flex space-x-8"><li><a href=https://fontysvenlo.github.io/prc2/pages/tips/ class="hover:text-sky-500 dark:hover:text-sky-400">Tips</a></li><li><a href=https://fontysvenlo.github.io/prc2/pages/setup/ class="hover:text-sky-500 dark:hover:text-sky-400">Setup</a></li></ul></nav><div class="flex items-center lg:border-l border-gray-200 ml-6 pl-6 dark:border-gray-700"><button type=button id=theme-toggle>
<span class="dark:hidden hover:text-sky-500"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span><span class="hidden dark:inline hover:text-sky-400"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span></button>
<a href=https://github.com/FontysVenlo/prc2 class="ml-6 block hover:text-sky-500 dark:hover:text-sky-400"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></div></div></div></div></header><div class="max-w-8xl mx-auto px-4 sm:px-6 md:px-8"><aside id=menu class="hidden lg:block fixed z-20 inset-0 top-[3.5rem] left-[max(0px,calc(50%-45rem))] right-auto w-[19.5rem] pb-10 px-8 overflow-y-auto bg-white dark:bg-gray-800"><nav class="lg:leading-6 relative"><ul class="block md:hidden"><li class="mt-12 lg:mt-8"><h5 class="mb-8 lg:mb-3 font-semibold text-slate-900 dark:text-slate-200">General</h5><ul class="space-y-2 border-l border-gray-100 dark:border-gray-700"><li><a href=https://fontysvenlo.github.io/prc2/pages/tips/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">Tips</a></li><li><a href=https://fontysvenlo.github.io/prc2/pages/setup/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">Setup</a></li></ul></li></ul><ul><li class="mt-12 lg:mt-8"><h5 class="mb-8 lg:mb-3 font-semibold text-slate-900 dark:text-slate-200">Weeks</h5><ul class="space-y-2 border-l border-gray-100 dark:border-gray-700"><li><a href=https://fontysvenlo.github.io/prc2/docs/unit-testing-basics/ class="block border-l pl-4 -ml-px
border-transparent hover:border-slate-400 dark:hover:border-slate-400 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200">01 Unit Testing Basics</a></li><li><a href=https://fontysvenlo.github.io/prc2/docs/parameterized-tests/ class="block border-l pl-4 -ml-px
border-transparent hover:border-slate-400 dark:hover:border-slate-400 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200">02 Parameterized tests</a></li><li><a href=https://fontysvenlo.github.io/prc2/docs/design-for-testability/ class="block border-l pl-4 -ml-px
border-slate-500 dark:border-slate-400 text-black dark:text-slate-200">03 Design for testability</a></li><li><a href=https://fontysvenlo.github.io/prc2/docs/generics/ class="block border-l pl-4 -ml-px
border-transparent hover:border-slate-400 dark:hover:border-slate-400 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200">04 Generics</a></li><li><a href=https://fontysvenlo.github.io/prc2/docs/jpms-lambda-streams/ class="block border-l pl-4 -ml-px
border-transparent hover:border-slate-400 dark:hover:border-slate-400 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200">05 JPMS, Lambda and Streams</a></li><li><a href=https://fontysvenlo.github.io/prc2/docs/database-access/ class="block border-l pl-4 -ml-px
border-transparent hover:border-slate-400 dark:hover:border-slate-400 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200">06 Database Access JDBC</a></li><li><a href=https://fontysvenlo.github.io/prc2/docs/javafx/ class="block border-l pl-4 -ml-px
border-transparent hover:border-slate-400 dark:hover:border-slate-400 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200">07 JavaFX</a></li><li><a href=https://fontysvenlo.github.io/prc2/docs/statemachine/ class="block border-l pl-4 -ml-px
border-transparent hover:border-slate-400 dark:hover:border-slate-400 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200">08 The State of Things</a></li></ul></li></ul></nav></aside><div class=lg:pl-[19.5rem]><div class="max-w-3xl mx-auto xl:max-w-none xl:ml-0 xl:mr-[15.5rem] xl:pr-16"><article id=main-content class="prose prose-slate dark:prose-invert max-w-none dark:prose-a:text-fuchsia-400 prose-a:text-fuchsia-500"><nav id=toc class=toc role=doc-toc><h2 id=toc-title>Table of Contents</h2><ol class="toc-list level-1"><li><a href=#_faking_as_a_testing_technique>Faking as a testing technique</a><ol class="toc-list level-2"><li><a href=#_stay_cool_have_a_mockito>Stay cool, have a Mockito.</a></li><li><a href=#_to_mock_or_to_configure>To Mock or To Configure</a></li></ol></li><li><a href=#_design_for_test_ability>Design for Test-ability</a><ol class="toc-list level-2"><li><a href=#_business_class_fit_for_testing>Business class fit for testing</a></li></ol></li></ol></nav><section class="doc-section level-1"><h2 id=_faking_as_a_testing_technique>Faking as a testing technique</h2><p><strong class=big>"When you can’t or won’t make it, Fake it"</strong></p><p>Let’s revisit the movie making metaphor. We know that almost everything in that industry
is fake, or maybe more politely <em>make-belief</em>. In that it only needs to look convincing without being the real thing.
So for instance, when someone needs to be hit hard in the face, it will not really be done and to make sure nothing untoward happens to
the expensive actors, they may be replaced by <em>stunt</em> men and women, so the punch will never land on the pretty face.</p><p>In our industry we have other reasons to <em>not</em> use the real thing.</p><div class=ulist><ul><li>It is not available (yet).</li><li>It is expensive (as in slow) to use and we want our tests to be quick.</li><li>We want to test behavior under circumstances that are rare, and difficult to achieve with the real thing.</li><li>It is inconvenient to use.</li></ul></div><p>What we do is replace the <strong>"Dependent On Components"</strong> by so called <strong class=blue>mocks</strong>.<br><strong>In all cases</strong>, the System Under Test (SUT), the class we are testing <strong>is always used as is</strong>. So we have no stunt doubles for our protagonist.
When testing, we want it to take all the punches, because we want to make sure it can handle them.</p><section class="admonition-block caution" role=doc-notice><h6 class="block-title label-only"><span class=title-label>Caution:</span></h6><p>A very common mistake made when using mocking as a testing technique, is <strong class=red>faking the protagonist or SUT</strong>.
This is <strong class=red>very wrong</strong>. What you are testing in that case is the mock, not the class you hope to test. <strong class=red>None</strong> of the code of the SUT will be used in such tests.</p></section><figure class="image-block right thumb"><img src=/prc2/images/fitness.jpg alt=fitness width=360><figcaption>Figure 1. Never imagined coding as a work out.</figcaption></figure><p>Suppose you have an application in which one of the required effects is
that a business class prints something to a printer. Turning this into a test will
give you a hard time, because you have to run between your desk an printer, but hey,
it will improve your fitness.<a class=footnote-ref id=_footnoteref_1 href=#_footnote_1 title="View footnote 1" role=doc-noteref>[1]</a>.</p><p>To verify that the system under test (<strong>SUT</strong>) does indeed use the printer, make that fact <em>observable</em>,
so that you can verify that the printer call has been made.
You can use a trick common to many informatics problems and is available to you too: <strong>add a level of indirection</strong>,
or do not give the actual printer to the business class but <em>instead</em> something that the business code
thinks it is a printer and replace that with whatever suits you for the test.</p><p><img src=/prc2/images/annoyed-32.png alt="annoyed 32" class=right,thumb>
<strong>'Nice'</strong> you say, <strong class=red>now I have two problems'</strong>:</p><div class="olist arabic"><ol class=arabic><li>change the application and</li><li>create a printer just for my tests.</li></ol></div><section class="doc-section level-2"><h3 id=_stay_cool_have_a_mockito>Stay cool, have a Mockito.</h3><figure class="image-block left thumb"><img src=/prc2/images/mockito-drink.jpg alt="mockito drink"><figcaption>Figure 2. it gets better.</figcaption></figure><p>You are not the first developer in this situation, so someone has automated the creation of 'fake' objects or mocks for us:<br><a href=https://site.mockito.org/ target=_blank rel=noopener>Mockito</a> is a framework that can create various objects that are useful for testing.</p><p><strong>Mock</strong> is an object that behave like a (alternate) implementation of a class or interface. This is akin to an actor (or actress) or stunt-double that
behaves exactly like you tell it to. A mock also saves any method call that you do on it.<br><strong>Stub</strong> just holds data that you provide and are presented to the SUT.<br>Both mock and stub are stand-ins for dependent on components (DOC) or collaborators for the SUT.<br>There is also a
<strong>Spy</strong> which is in fact a wrapper around an actual implementation, that allows you to observe what goes in (method call+ parameters) and comes
out of (return values) of the real object while it is used by the SUT. You can make the spy only spy on certain method calls, and leave the rest unchanged.</p><figure class=image-block><img src=/prc2/images/mockstubsspies.svg alt=mockstubsspies><figcaption>Figure 3. Class diagram explaining mocks, stubs and spies</figcaption></figure><p>Lets see what this looks like in code.</p><figure class=listing-block><figcaption>The printer interface.</figcaption><pre class=highlight><code class=language-java data-lang=java>public interface Printer {

    void println( String print );

    /**
     * Make it deal with objects too.
     * @param o to print.
     */
    default void println( Object o ) {
        printLn( o.toString() );
    }
}</code></pre></figure><p>Now over to the test class, which creates a mocked printer and hands it to the <strong>Business</strong> class.</p><figure class=listing-block><figcaption>Business test class.</figcaption><pre class=highlight><code class=language-java data-lang=java>    @Test
    public void doesItPrint() {
        Printer pr = mock( Printer.class );  <b class=conum>1</b>

        Business b = new Business( pr );     <b class=conum>2</b>

        b.work();                                 <b class=conum>3</b>

        verify( pr ).println( anyString() ); <b class=conum>4</b>

    }</code></pre><ol class="callout-list arabic"><li>Create the mocked printer.</li><li>Create a Business object passing it the printer.</li><li>Make the business class work.</li><li>Ask the mocked printer if it was used.</li></ol></figure><p>This is of course a simple test and the only thing that it verifies is that the <code>printer.printLn(String)</code> has been used.</p><figure class=listing-block><figcaption>Verify that what is printed is okay.</figcaption><pre class=highlight><code class=language-java data-lang=java>@Mock
Printer printer; <b class=conum>1</b>

Business business;

@BeforeEach
void setup() {
    business = new Business( printer );  <b class=conum>2</b>
}

@Test
void doesItPrintBusiness() {
    var lineCaptor = ArgumentCaptor.forClass( String.class ); <b class=conum>3</b>

    business.work( &#34;Linda&#34; ); <b class=conum>4</b>

    verify( printer ).println( lineCaptor.capture() ); <b class=conum>5</b>
    assertThat( lineCaptor.getAllValues() ).contains( &#34;Hello Linda&#34; ); <b class=conum>6</b>
    //  fail(&#34;test does It print ended. You know what to do.&#34;);
}</code></pre><ol class="callout-list arabic"><li>Setup mock as annotated field.</li><li>Create the business (SUT) object in a setup method, so tests can avoid repeating this,<br>again passing the printer object via the business constructor.</li><li>Prepare a Mockito helper object to capture the data passed to the printer.</li><li>Make business do its thing.</li><li>Verify that <code>printer.println(…​)</code> is called. The captor object is used to
collect all that has been received by the printer’s <code>printLn</code> method.</li><li>The expected data is passed to the printer, so a real printer would
print it. The method <code>lineCaptor.getAllValues()</code> produces a List of the captured things, strings in this case.</li></ol></figure><p>Mockito is well documented with lots of examples in its <a href=https://javadoc.io/static/org.mockito/mockito-core/3.2.4/org/mockito/Mockito.html>java doc</a>.
When you look to the test dependencies of your Maven project in NetBeans-IDE, right-click on the
mockito dependency, then download the javadoc, you can enjoy that while you are developing.</p></section><section class="doc-section level-2"><h3 id=_to_mock_or_to_configure>To Mock or To Configure</h3><p>Sometimes the class that you want to pass as a mock to the business code has a <strong class=big>big</strong> interface, with
many methods, and you do not want to restrict the business code to just a few trained methods. That would
constrain the methods that the business class could use, which serves no real purpose. In such cases it
may be better to provide a differently configured <strong class=blue>real class</strong>.</p><section class="doc-section level-3"><h4 id=_input_stubbing_with_a_real_class>Input stubbing with a real class.</h4><p>An object that contains pre-configured data is called a <strong>Stub</strong>.<br>As an example: Assume your business class uses a Scanner as it’s input.
<a href=https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Scanner.html><code>Scanner</code></a> has 50-odd methods, which you certainly do not want to train <em>all</em> when mocking.</p><p>But since you will pass a special Scanner to the business class anyway, the better way is to use a Scanner configured with one of
it’s constructors.
In this case use <code>new Scanner( String s )</code>, in which the string <code>s</code> contains exactly the input you want to use in your test. The string can contain newlines, so that it appears as if the user entered multiple lines. This allows you to test a program with a dialog.
Something along the line of <code>new Scanner("12\n13\n");</code>, that is '12', 'newline', and '13'.</p></section><section class="doc-section level-3"><h4 id=_output_mocking_with_a_real_classes>Output mocking with a real classes</h4><p>THIS PARAGRAPH DESCRIBES AN ADVANCED TOPIC THAT YOU DON’T NEED IMMEDIATELY. FINE IF YOU UNDERSTAND IT, IF NOT THEN JUST CONTINUE WITH THE NEXT PARAGRAPH ABOUT TESTABLE DESIGN.</p><p>For the output side something similar is in effect. The most common way of outputting something
is to use System.out to print or otherwise output the results of the program. But <code class=blue>System.out</code> is
just a <code class=blue>PrintStream</code>, which also has a lot of convenience methods with a total of 33 methods and 10 constructors.
You do not want to restrict the use of any of its methods in the business class.</p><p>The trick here is to use one of the constructors to given PrintStream something to 'print on', which you can inspect afterwards.
Usage: The business class has a constructor.<a class=footnote-ref id=_footnoteref_2 href=#_footnote_2 title="View footnote 2" role=doc-noteref>[2]</a> or setter to take a PrintStream and always uses that to print to, if
it needs to print anyway.</p><figure class=listing-block><figcaption>Usage is business code</figcaption><pre class=highlight><code class=language-java data-lang=java>class PrintingBusiness
      final PrintStream out; <b class=conum>1</b>

      PrintingBusiness() { <b class=conum>2</b>
          this( System.out );
      }

      PrintingBusiness( PrintStream ps ) { <b class=conum>3</b>
          this.out=ps;
      }

      void businessMethod(){
          out.format( &#34;%s at %d&#34;, &#34;Oplegkaas&#34;, 957 ); <b class=conum>4</b>
      }
}</code></pre><ol class="callout-list arabic"><li><code class=blue>final</code> to have a constructor set it</li><li>Default constructor uses System.out to print to and forwards it to the next constructor.</li><li>Redirect output to other output, for test or 'printing' in a GUI.</li><li>All facilities of PrintStream are available, including formatted printing.</li></ol></figure><figure class=listing-block><figcaption>Use in tests</figcaption><pre class=highlight><code class=language-java data-lang=java>    @Test
    public void tformattedPrint() {
        ConsoleOutput cout = new ConsoleOutput();
        PrintStream out = cout.asPrintStream();

        out.format( &#34;%s at %d&#34;, &#34;Oplegkaas&#34;, 957 );

        assertThat( cout.toString() ).contains( &#34;at&#34;, &#34;Oplegkaas&#34;, &#34;957&#34; );
    }</code></pre></figure><p>By implementing the <code>AppendAndClear</code> interface you can print to anything, for instance
by using a <code>StringBuilder</code> as intermediate carrier and then transfer the output to a GUI element in JavaFX or Swing.</p><figure class=listing-block><figcaption>Definition of AppendAndClear interface.</figcaption><pre class=highlight><code class=language-java data-lang=java>@FunctionalInterface
public interface AppendAndClear {

    /**
     * Append a string to this AppendAndClear.
     *
     * @param toAppend text to add.
     */
    void appendText( String toAppend );

    /**
     * Clear the output. Optional operation.
     */
    default void clear() {
    }
}</code></pre></figure><figure class=listing-block><figcaption>Implementation of ConsoleOutput</figcaption><pre class=highlight><code class=language-java data-lang=java>package consoleoutput;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.io.PrintStream;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;

/**
 * Test helper, to be able to redirect a PrintStream to any writable.
 *
 * Use case: write to string or StringBuilder for test or e.g. javafx
 * TextInputControl for UI. Implement AppendAndClear (which can be done as a
 * lambda) and you&#39;re set.
 *
 * @author Pieter van den Hombergh {@code &lt;p.vandenhombergh@fontys.nl&gt;}
 */
public class ConsoleOutput extends OutputStream {

    protected final ByteArrayOutputStream baos = new ByteArrayOutputStream();
    final AppendAndClear aac;

    /**
     * Create a Console output copying data to given AppendAndClear.
     *
     * @param ta append and clear to copy all written text to.
     */
    public ConsoleOutput( AppendAndClear ta ) {
        this.aac = ta;
    }

    /**
     * Without appendable.
     */
    public ConsoleOutput() {
        this( null );
    }

    @Override
    public void write( int b ) throws IOException {
        if ( aac != null ) {
            String s = &#34;&#34; + ( (char) b );
            aac.appendText( s );
        }
        baos.write( (byte) b );
    }

    /**
     * Clear and discard output.
     */
    public void clear() {
        if ( aac != null ) {
            aac.clear();
        }
        baos.reset();
    }

    /**
     * Get the accumulated string since start or clear.
     *
     * @return the string
     */
    @Override
    public String toString() {
        return new String( baos.toByteArray(), StandardCharsets.UTF_8 );
    }

    /**
     * Factory method to get this ConsoleOutput as PrintStream.
     *
     * @return the print stream.
     */
    public PrintStream asPrintStream() {
        return new PrintStream( this, true, Charset.defaultCharset() );
    }
} // eof ConsoleOutput</code></pre></figure><aside class=sidebar><h6 class=block-title>You can redirect standard output and standard error this way</h6><p>You can modify standard output, a.k.a. <code class=blue>System.out</code> so that it writes to somewhere else,
for instance to something like the console output above. <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/System.html#setOut(java.io.PrintStream)><code>System.setOut(PrintStream)</code></a>
can be used for standard output. This is also the trick that the PRC1 MOOC used to test output by the first programs.
Important is that it can also be applied to <strong class=blue>static</strong>
methods such as the well known <code>public static void main(String[])</code> that can’t be used with Dependency Inversion as we do here.</p></aside><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>Real class configuration, if applicable, beats mocking. So if there is an existing class, first study it’s API, before you
consider mocking it. Using the <strong class=big>Real Thing</strong> may be the better choice <strong class=green>AND</strong> less work.<br>Along that line: It is seldom useful to mock an <em>entity</em> class, like a <code>Student</code> or <code>Product</code>, because the mock will have no benefit
over the real thing, since the entity is just a data carrier with no logic. The typical shape of an entity is a constructor,
a few getters and some other generated boilerplate code, such as <code>toString()</code>, <code>equals(Object)</code> and <code>hashCode()</code>.
Java 14+ records will be a good substitute for such classes.</p></aside></section></section></section><section class="doc-section level-1"><h2 id=_design_for_test_ability>Design for Test-ability</h2><p>Also known as dependency injection made simple.</p><p><strong class=big>A very important <span class=green>non functional</span> requirement of good software is <em class=green>Test-ability</em>.<br>Test-ability can be achieved or improved by decoupling the class you are developing (the SUT) from it’s environment, such that you have
full control over that environment in your test and can exactly control and observe what goes in or out of the SUT.</strong></p><p>One first easy setup is to use <strong class=blue>package private</strong> visibility more often. It is actually the <em>default</em> in java, and with reason.
When you then put your unit test in the same package (but it its own source tree), you can have the test class look at
or use the package private members of the class in its <em>assertion</em> or verification very easily.
Most of unit testing is <a href=https://en.wikipedia.org/wiki/White-box_testing>white box testing</a> anyway, which almost always includes inspecting private members.</p><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>For <strong>business</strong> code, organize your packages according to the collaborations the classes will have.
In particular do <strong class=red>NOT</strong> organize classes according to type or kind,
like collections with collections and exceptions with exceptions. To express it as a metaphor: If you always keep your screws, seats, and back-rests in separate
rooms, they will never build chairs. You need to put them together, to make them cooperate.<br>For <strong>library</strong> code, other aspects such as find-ability may take precedence over tight packages. But when you study the java libraries
your will see classes in packages that are package private, to help the public types in the package to do their bidding.</p></aside><p>Test-ability is also improved by using the design rule <strong class=green>program against interfaces, not concrete classes</strong>.<br>If you do that in your design, you can very easily make specialized implementations of those interface methods that you need in your test, to provide
those specific values or reactions that you need in your test, without having to jump through a lot of hoops to get the test set up.<br>This easy setup is where <strong class=green>Mockito</strong> comes in.</p><p>It is <span class=red>not</span> the business' business to worry about:<br><i class="fa fa-times fa-fw red"></i> <s>persistence</s><br><i class="fa fa-times fa-fw red"></i> <s>where service come from or who implements them.</s></p><p>By <em>injecting</em> or otherwise providing the business with the services it <em>needs</em> makes
the business code testable without making it dependent or even know the actual implementing classes. And that is really all that counts. The business code
makes the application valuable, the rest is either plumbing or already available code.<a class=footnote-ref id=_footnoteref_3 href=#_footnote_3 title="View footnote 3" role=doc-noteref>[3]</a>.</p><section class="admonition-block warning" role=doc-notice><h6 class="block-title label-only"><span class=title-label>Warning:</span></h6><p><strong class=red>Never</strong> let the business code <em>create</em> its own persistence or or service object. You would
<strong class="big red">loose control</strong> over what flows between service and business class,
and makes it <em class=red>unobservable</em>, which is bad from the testing standpoint.</p></section><p>Instead hand the service or resource to the business, or give it some provider of a resource.</p><section class="doc-section level-2"><h3 id=_business_class_fit_for_testing>Business class fit for testing</h3><p><strong class=blue>WE’LL FURTHER EXPLAIN THIS CONCEPT IN CLASS AND IN THE CONTEXT OF PRJ2. THERE ARE QUITE SOME DESIGN IDEAS BEHIND IT, SO DON’T WORRY IF YOU DON’T UNDERSTAND IT IMMEDIATELY.</strong></p><p>Let us look at an example as a class diagram.</p><figure class=image-block><img src=/prc2/images/businessarch.svg alt=businessarch><figcaption>Figure 4. Giving the business what it really needs make the business testable</figcaption></figure><figure class=image-block><img src=/prc2/images/businesstest.svg alt=businesstest><figcaption>Figure 5. business class in the test lab</figcaption></figure><p>In the picture above you see a class diagram which shows a detail in which a business class
'lives' in an environment that is designed to make sure the business class sticks to its business:</p><p><i class="fa fa-check fa-fw green"></i> Dealing with business entities such as customers and products.<br><i class="fa fa-check fa-fw green"></i> Uses services to do the business' bidding, such as saving stuff to a database,
provided as a service to the business class.<br><i class="fa fa-check fa-fw green"></i> And the business code <strong class=red>NOT</strong> responsible for <em class=blue>how</em> to show things in a UI.</p><p>In the above example we provide a <span class=blue>factory</span> or <span class=blue>provider</span> of the services that the business code requires.</p><p>The business class appears in two worlds:</p><div class="olist arabic"><ol class=arabic><li>A <em class=blue>business</em> world, the <strong class=blue>Application</strong>. This is the actual use and role in the whole application.
In that world there is a so called Assembler, that stitches the parts of the application together and sets it on its way. Typically this Assembler
role is what the <strong>main</strong> class in a project does. Find the parts, put them together, and put them to work.</li><li>In the <strong class=red>Test</strong> world, call it the laboratory or <em>business</em>.<a class=footnote-ref id=_footnoteref_4 href=#_footnote_4 title="View footnote 4" role=doc-noteref>[4]</a> school, where the business class is trained and tested.
Here the test class does the assembling with a dash of Mockito to get good grips on what goes into and out of the business class.</li></ol></div><p>Before the business class can used in real life, it has to be trained and tested. Feels a bit like a student right?</p><p>You should note the arrows in the diagram. They provide direction and make it the diagram a <a href=https://en.wikipedia.org/wiki/Directed_graph>directed graph</a>,
and lets a <em>dependent</em> point to a <em>depends-on</em>, like
the <strong>BusinessClass</strong> depends on a <strong>Service</strong>, which is an <em>abstract</em> class or better still, an <em>interface</em>.
Also note that the service does not point to, or is dependent on the business, which is good, because it makes the service reusable in other contexts.<br>The service implementing classes are dependent on the Service definition which is shown with the "implements arrow", pointing from sub to super type.</p><p>In the business school, there is a test class, that creates instances of the business class and hands it implementations of the services the business
needs, but does that by giving it a specialized service factory that produces <em class=green>mock</em>
service implementations. The business class is <strong class=green>NOT</strong> aware of that.
It uses the service in the way it is programmed, which allows the test class to verify that that programming is correct.
The test class is in complete control and can also give the business class situations
that are extensions to the normal <em class=green>happy</em> path to ensure that those situations are also handled properly. If that sounds like an
exam setting at school, you would be right.</p><p>You can tell these worlds in the class diagrams apart by the fact that one has a pink <strong>BusinessTest</strong> class with test methods.</p><p>In the 'normal' non-testing <strong class=blue>Application world</strong>, the design has taken some provisions to make sure the business class can work in both worlds.
To provide the business class with a <em>factory</em> from which it can obtain Service implementations, a so called <strong>Assembler</strong> is added. This <strong class=cyan>Assembler</strong>,
in the figure at the top of the application class diagram, typically creates or instantiates the business class and provides it with all it needs,
in this case an implementation of a <strong>ServiceFactory</strong>.
Note that the assembler in this case also creates the UI part. In desktop applications this is the responsibility of the <strong>Main</strong> class of the application.</p><p>This approach of <em>providing</em> an instance of some class implementing an interface or
realizing an abstract class to a business class that needs it is called <strong>dependency injection</strong>.</p><p><a href=https://martinfowler.com/articles/injection.html><strong>Dependency injection</strong></a> <em>is providing the services
required by some class by means of constructor parameters, setters or otherwise,
to avoid that the dependencies of the class are created by that class itself.</em></p><aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip:</span></h6><p>The code in your tests also serve as a kind of <strong class=blue>documentation</strong>, at least for
the maintainer of the test and code. This implies that any mock that you configure
should match the test scenario, no more no less.<br>That’s why Mockito <strong class=red>complains</strong> when you mock something or train a method, but do <strong class=red>not</strong> use it in the test.</p><figure class=listing-block><figcaption>example Mockito Warning</figcaption><pre class=highlight><code class=language-sh data-lang=sh>Unnecessary stubbings detected.
Clean &amp; maintainable test code requires zero unnecessary code.
Following stubbings are unnecessary (click to navigate to relevant line of code):
1. -&gt; at ps.CashRegisterTest.isProductLookedUpAndDisplayed(CashRegisterTest.java:71)
Please remove unnecessary stubbings or use &#39;lenient&#39; strictness.
More info: javadoc for UnnecessaryStubbingException class.</code></pre></figure><p>When a mock is not used, and unverified, Mockito warns you about the fact. It might be an oversight on the side of the
test or indeed a smell of a flaw in the business code. So take the Mockito warning <span class="big green">seriously</span>.</p></aside></section></section><section class=footnotes aria-label=Footnotes role=doc-endnotes><hr><ol class=footnotes><li class=footnote id=_footnote_1 role=doc-endnote>(source picture "https://www.menshealth.com/nl/fitness/") <a class=footnote-backref href=#_footnoteref_1 role=doc-backlink title="Jump to the first occurrence in the text">↩</a></li><li class=footnote id=_footnote_2 role=doc-endnote>best <a class=footnote-backref href=#_footnoteref_2 role=doc-backlink title="Jump to the first occurrence in the text">↩</a></li><li class=footnote id=_footnote_3 role=doc-endnote>And hopefully tested <a class=footnote-backref href=#_footnoteref_3 role=doc-backlink title="Jump to the first occurrence in the text">↩</a></li><li class=footnote id=_footnote_4 role=doc-endnote>pun intended <a class=footnote-backref href=#_footnoteref_4 role=doc-backlink title="Jump to the first occurrence in the text">↩</a></li></ol></section></article></div><footer class="text-sm leading-6 mt-12 mb-5">Theme provided by <a class="text-pink-500 underline" href=https://github.com/FontysVenlo/sebi-theme target=_blank>SeBi Venlo</a></footer><div class="fixed z-20 top-[3.8125rem] bottom-0 right-[max(0px,calc(50%-45rem))] w-[19.5rem] py-10 px-8 overflow-y-auto hidden xl:block"><h5 id=toc-header class="text-slate-900 font-semibold mb-4 text-sm leading-6 dark:text-slate-200">On this page</h5></div></div><div class="hidden lg:hidden fixed inset-0 z-10 bg-gray-900/50 dark:bg-gray-900/60" id=menu-backdrop></div></div><script src=/prc2/js/main.min.956966b3103878d329f9460daf829f6ad1d50fc9e24d20ff0c5d93a4006065df877564edc24b6a2a5182bf4387d13d9f960a1df6fc9d259d38cfb8e83509c999.js integrity="sha512-lWlmsxA4eNMp+UYNr4KfatHVD8niTSD/DF2TpABgZd+HdWTtwktqKlGCv0OH0T2flgod9vydJZ04z7joNQnJmQ==" crossorigin=anonymous></script>
<script src=/prc2/js/highlight.min.cd8091de05577194483fff730f723dc2379226a640ef117b33ad133cc3da2f690d95af8fc32186b11dc10628e66e325b33bee2bf443c98315905e50f22aecc50.js integrity="sha512-zYCR3gVXcZRIP/9zD3I9wjeSJqZA7xF7M60TPMPaL2kNla+PwyGGsR3BBijmbjJbM77iv0Q8mDFZBeUPIq7MUA==" crossorigin=anonymous defer></script><div id=copied-alert class="invisible opacity-0 transition-all ease-in-out duration-400 fixed bottom-3 right-10 z-50 flex p-4 mb-4 text-sm text-gray-800 bg-gray-200 rounded-lg dark:bg-gray-500 dark:text-gray-200" role=alert><svg class="inline flex-shrink-0 mr-3 w-5 h-5" viewBox="0 0 24 24" width="24" height="24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg><div><span class=font-medium>Code copied</span></div></div></body></html>