<!doctype html><html lang=en-us><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>PRC2</title>
<link rel=stylesheet href=https://fontysvenlo.github.io/prc2_web/css/main.min.1f4ad530bab3a8acf019ab3ecf1f428b84fcdea56c601071ed78c78b78a7db73162d2d127488c5e2fbc37812b003229902671d324b822f225e123f723bad1655.css integrity="sha512-H0rVMLqzqKzwGas+zx9Ci4T83qVsYBBx7XjHi3in23MWLS0SdIjF4vvDeBKwAyKZAmcdMkuCLyJeEj9yO60WVQ==" crossorigin=anonymous>
<link rel=stylesheet href=https://fontysvenlo.github.io/prc2_web/css/highlight.9e5322c61da2ab0997ce2db01648537ffacdb7b808fc24af4d99ff51257c59db9500031551feb8e62cafde7a246ae2c0015c2862637519a22eb0b49fa7b9d2f9.css integrity="sha512-nlMixh2iqwmXzi2wFkhTf/rNt7gI/CSvTZn/USV8WduVAAMVUf645iyv3nokauLAAVwoYmN1GaIusLSfp7nS+Q==" crossorigin=anonymous>
</head><body class="antialiased text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800"><header class="sticky top-0 z-40 w-full flex-none lg:border-b lg:border-gray-900/10 dark:border-gray-50/[0.06] bg-white dark:bg-gray-800">
<div class="max-w-8xl mx-auto">
<div class="py-4 border-b border-slate-900/10 lg:px-8 lg:border-0 dark:border-slate-300/10 mx-4 lg:mx-0">
<div class="relative flex items-center">
<a class="mr-3 flex-none overflow-hidden md:w-auto" href=/>
<span class=sr-only>PRC2</span>PRC2
</a>
<div class="relative flex ml-auto">
<nav class="hidden lg:flex items-center text-sm leading-6 font-semibold text-gray-700 dark:text-gray-200">
<ul class="flex space-x-8">
</ul>
</nav>
<div class="flex items-center lg:border-l border-gray-200 ml-6 pl-6 dark:border-gray-700">
<button type=button id=theme-toggle>
<span class="dark:hidden hover:text-sky-500"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span>
<span class="hidden dark:inline hover:text-sky-400"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
</button>
<a href=https://github.com/FontysVenlo/prc2_web class="ml-6 block hover:text-sky-500 dark:hover:text-sky-400"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
</div>
</div>
</div>
</div>
<div class="flex items-center p-4 border-b border-slate-900/10 lg:hidden dark:border-slate-50/[0.06]">
<button id=menu-toggle type=button class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
<span class=sr-only>Navigation</span><svg viewBox="0 0 24 24" width="20" height="20" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
</div>
</div>
</header><div class="max-w-8xl mx-auto px-4 sm:px-6 md:px-8"><aside id=menu class="hidden lg:block fixed z-20 inset-0 top-[7rem] lg:top-[3.8125rem] left-[max(0px,calc(50%-45rem))] right-auto w-[19.5rem] pb-10 px-8 overflow-y-auto bg-white dark:bg-gray-800">
<nav class="lg:leading-6 relative">
<ul>
<li class="mt-12 lg:mt-8">
<h5 class="mb-8 lg:mb-3 font-semibold text-slate-900 dark:text-slate-200">Weeks</h5>
<ul class="space-y-6 lg:space-y-2 border-l border-gray-100 dark:border-gray-700">
<li>
<a href=https://fontysvenlo.github.io/prc2_web/docs/unit-testing-basics/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">
Unit Testing Basics
</a>
</li>
<li>
<a href=https://fontysvenlo.github.io/prc2_web/docs/parameterized-tests/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">
Parameterized tests
</a>
</li>
</ul>
</li>
</ul>
</nav>
</aside><div class=lg:pl-[19.5rem]>
<div class="max-w-3xl mx-auto xl:max-w-none xl:ml-0 xl:mr-[15.5rem] xl:pr-16">
<article id=main-content class="prose prose-slate dark:prose-invert max-w-none dark:prose-a:text-fuchsia-400 prose-a:text-fuchsia-500">
<div class=sect1>
<h2 id=_test_recipe_i_test_equals_and_hashcode>Test Recipe I, Test Equals and hashCode</h2>
<div class=sectionbody>
<div class=paragraph>
<p>We may sprinkle our testing stuff with a few recipes for often occurring tests.
This is the the first installment.</p>
</div>
<div class=paragraph>
<p><strong>Equals</strong> and <strong>hashCode</strong> are not twins in the direct sense, but indeed methods whose implementation should
have a very direct connection.
From the java <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#hashCode() target=_blank rel=noopener>Object API </a> follows
that:</p>
</div>
<div class=ulist>
<ul>
<li>
<p>Two objects that are equal by their equal method, than their hashCode should also be equal.</p>
</li>
<li>
<p>Note that the reverse is not true. If two hashCode are the same, that does not imply that the objects are equal.</p>
</li>
<li>
<p>A good hashCode 'spreads' the objects well, but this is not a very strict requirement or a requirement that can be enforced. A poor hashCode
will lead to poor Hash{Map|Set} lookup performance.</p>
</li>
</ul>
</div>
<div class=paragraph>
<p>Although hashCodes are invented to speedup finding object in a hash map or hash set, these collections use hashCode in the first part of the search,
but must verify equality as final step(s).</p>
</div>
<div class=paragraph>
<p>The thing is that the equals method must consider quite a few things, expressed with conditional evaluation (if-then-else).
The good thing is an IDE typically provides a way to generate equals and hashCode for you and these implementations are typically of good quality. But
in particular the equals method there are quite some ifs, sometimes in disguise, coded as <code>&&</code>, so this will throw some flies in your code-coverage ointment.</p>
</div>
<div class=paragraph>
<p>However, we can balance this generated code by a piece of reusable test code, that can be used for almost all cases.
In fact we have not found a case where it does not apply.<br>
Let us first explain the usage and then the implementation.<br>
Suppose you have an object with three fields, <code>name</code>, <code>birthDate</code> and <code>id</code>. All these fields should be considered in equals and hashCode.<br>
As an exercise, create such and object now in your IDE, call it Student, why not.</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-java data-lang=java>class Student {
  final String name;
  final LocalDate birthDate;
  final int id;
}</code></pre>
</div>
</div>
<div class=paragraph>
<p>From the above, the IDE can generate a <strong>constructor</strong>, <strong>equals</strong> and <strong>hashCode</strong> and <strong>toString</strong>. What are you waiting for? Because it is not test driven?
You would be almost right, but why test drive something that can be generated.<br>
However, if your spec does <strong class=red>not</strong> demand equals and hashCode,
then <strong class="red big">do not write/generate</strong> them. That would be unwanted code. But if the requirements DO insist on equals and hashCode,
make sure that the fields to be considered match the requirements. Choose only final fields.</p>
</div>
<div class=paragraph>
<p>After having such a generated equals and hashCode you have the predicament of writing a test. HashCode is relatively easy. It should produce an
integer, but what value is unspecified, so just invoking it would do the trick for test coverage.
The devil is in the equals details, because it has to consider:</p>
</div>
<div class=ulist>
<ul>
<li>
<p>Is the other object <code>this</code>? If yes, return <code>true</code>.</p>
</li>
<li>
<p>Is the other object <code>null</code>? Return <code>false</code> if it is.</p>
</li>
<li>
<p>Now consider the type.<sup class=footnote>[<a id=_footnoteref_1 class=footnote href=#_footnotedef_1 title="View footnote.">1</a>]</sup>.</p>
<div class=ulist>
<ul>
<li>
<p>Is the other of the same type as <code>this</code>? If not return <code>false</code>.</p>
</li>
<li>
<p>Now we are in known terrain, the other is of the same type, so the object has the same fields.<br>
For each field test it <code>this.field.equals(other.field)</code>. If not return false.</p>
</li>
<li>
<p>Using <code>Objects.equals(this.fieldA, other.fieldB)</code> can be an efficient solution to avoid testing for nullity of either field.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class=listingblock>
<div class=title>Generated equals. It is fine.</div>
<div class=content>
<pre class=highlight><code class=language-java data-lang=java>    @Override
    public boolean equals( Object obj ) {
        if ( this == obj ) {
            return true;
        }
        if ( obj == null ) {
            return false;
        }
        if ( getClass() != obj.getClass() ) {
            return false;
        }
        final Student other = (Student) obj;
        if ( this.id != other.id ) {
            return false;
        }
        if ( !Objects.equals( this.name, other.name ) ) {
            return false;
        }
        return Objects.equals( this.birthDate, other.birthDate );
    }</code></pre>
</div>
</div>
<div class=paragraph>
<p>You see a pattern here: The number of ifs is 3 + the number of fields.<br>
To test this, and to make sure you hit all code paths, you need to test with this,
with null, with an distinct (read newly constructed) object with all fields equal,
and then one for each field, which differs from the reference object only in said field.</p>
</div>
<div class=paragraph>
<p>Define those instances (for this example) as follows.</p>
</div>
<div class=listingblock>
<div class=title>Instances for complete equals and hashCode test and coverage</div>
<div class=content>
<pre class=highlight><code class=language-java data-lang=java>    //@Disabled
    @Test
    void testEqualsAndHash() {
        Student ref = new Student( &#34;Jan&#34;, LocalDate.of( 1999, 03, 23 ), 123 );
        Student equ = new Student( &#34;Jan&#34;, LocalDate.of( 1999, 03, 23 ), 123 );
        Student sna = new Student( &#34;Jen&#34;, LocalDate.of( 1999, 03, 23 ), 123 ); <img src=/prc2_web/icons/callouts/1.svg alt=1>
        Student sda = new Student( &#34;Jan&#34;, LocalDate.of( 1998, 03, 23 ), 123 ); <img src=/prc2_web/icons/callouts/2.svg alt=2>
        Student sid = new Student( &#34;Jan&#34;, LocalDate.of( 1999, 03, 23 ), 456 ); <img src=/prc2_web/icons/callouts/3.svg alt=3>
        verifyEqualsAndHashCode( ref, equ, sna, sda, sid );
        //fail( &#34;testMethod reached it&#39;s and. You will know what to do.&#34; );
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><img src=/prc2_web/icons/callouts/1.svg alt=1></td>
<td>Differs in name.</td>
</tr>
<tr>
<td><img src=/prc2_web/icons/callouts/2.svg alt=2></td>
<td>Differs in birthdate (year).</td>
</tr>
<tr>
<td><img src=/prc2_web/icons/callouts/3.svg alt=3></td>
<td>Differs in id.</td>
</tr>
</tbody></table>
</div>
<div class=paragraph>
<p>The implementation of the <code>verifyEqualsAndHashCode</code> has been done with generics and a dash of AssertJ stuff.</p>
</div>
<div class=listingblock>
<div class=title>Sample test helper in separate class.</div>
<div class=content>
<pre class=highlight><code class=language-java data-lang=java>    /**
     * Helper for equals tests, which are tedious to get completely covered.
     *
     * @param &lt;T&gt; type of class to test
     * @param ref reference value
     * @param equal one that should test equals true
     * @param unEqual list of elements that should test unequal in all cases.
     */
     public static &lt;T&gt; void verifyEqualsAndHashCode( T ref, T equal, T... unEqual ) {
         Object object = &#34;Hello&#34;;
         T tnull = null;
         String cname = ref.getClass().getCanonicalName();
         // I got bitten here, assertJ equalTo does not invoke equals on the
         // object when ref and &#39;other&#39; are same.
         // THAT&#39;s why the first one differs from the rest.
         SoftAssertions.assertSoftly( softly-&gt; {
           softly.assertThat( ref.equals( ref ) )
                   .as( cname + &#34;.equals(this): with self should produce true&#34; )
                   .isTrue();
           softly.assertThat( ref.equals( tnull ) )
                   .as( cname + &#34;.equals(null): ref object &#34;
                           + safeToString( ref ) + &#34; and null should produce false&#34;
                   )
                   .isFalse();
           softly.assertThat( ref.equals( object ) )
                   .as( cname + &#34;.equals(new Object()): ref object&#34;
                           + &#34; compared to other type should produce false&#34;
                   )
                   .isFalse();
           softly.assertThat( ref.equals( equal ) )
                   .as( cname + &#34; ref object [&#34; + safeToString( ref )
                           + &#34;] and equal object [&#34; + safeToString( equal )
                           + &#34;] should report equal&#34;
                   )
                   .isTrue();
           for ( int i = 0; i &lt; unEqual.length; i++ ) {
               T ueq = unEqual[ i ];
               softly.assertThat( ref )
                       .as(&#34;testing supposed unequal objects&#34;)
               .isNotEqualTo( ueq );
           }
           // ref and equal should have same hashCode
           softly.assertThat( ref.hashCode() )
                   .as( cname + &#34; equal objects &#34;
                           + ref.toString() + &#34; and &#34;
                           + equal.toString() + &#34; should have same hashcode&#34;
                   )
                   .isEqualTo( equal.hashCode() );
        });
     }

    /**
     * ToString that deals with any exceptions that are thrown during its
     * invocation.
     *
     * When x.toString triggers an exception, the returned string contains a
     * message with this information plus class and system hashCode of the
     * object.
     *
     * @param x to turn into string or a meaningful message.
     * @return &#34;null&#34; when x==null, x.toString() when not.
     */
    public static String safeToString( Object x ) {
        if ( x == null ) {
            return &#34;null&#34;;
        }
        try {
            return x.toString();
        } catch ( Throwable e ) {
            return &#34;invoking toString on instance &#34;
                    + x.getClass().getCanonicalName() + &#34;@&#34;
                    + Integer.toHexString( System.identityHashCode( x ) )
                    + &#34; causes an exception &#34; + e.toString();
        }
    }</code></pre>
</div>
</div>
<div class=paragraph>
<p>The above code has been used before but now adapted for AssertJ and JUnit 5.</p>
</div>
<div class=paragraph>
<p>It is of course best to put this in some kind of test helper library, so you can reuse it over and over without having to
resort to copy and waste.</p>
</div>
<hr>
</div>
</div>
<div id=footnotes>
<hr>
<div class=footnote id=_footnotedef_1>
<a href=#_footnoteref_1>1</a>. Not all equals implementation look at the type of this, See the java.util.List doc for a counter example
</div>
</div>
</article>
</div><footer class="text-sm leading-6 mt-12">
Footer
</footer><div class="fixed z-20 top-[3.8125rem] bottom-0 right-[max(0px,calc(50%-45rem))] w-[19.5rem] py-10 px-8 overflow-y-auto hidden xl:block">
<h5 id=toc-header class="text-slate-900 font-semibold mb-4 text-sm leading-6 dark:text-slate-200">On this page</h5>
<nav id=TableOfContents>
<ul>
<li><a href=#_test_recipe_i_test_equals_and_hashcode>Test Recipe I, Test Equals and hashCode</a></li>
</ul>
</nav>
</div></div>
<div class="hidden lg:hidden fixed inset-0 z-10 bg-gray-900/50 dark:bg-gray-900/60" id=menu-backdrop></div>
</div><script src=/prc2_web/js/main.min.f1aab0f377564ee438c29317379d3f3a0f439940032b9f85b111f678488256c83855d0eb3ea171cc9d86f0739f20537604bd541b05eb8a127b5162a683ea8b4a.js integrity="sha512-8aqw83dWTuQ4wpMXN50/Og9DmUADK5+FsRH2eEiCVsg4VdDrPqFxzJ2G8HOfIFN2BL1UGwXrihJ7UWKmg+qLSg==" crossorigin=anonymous></script>
<script src=/prc2_web/js/highlight.min.f1690c458d098f45f338cfee7494988dcfae16778ad557952b7362e8ba6c54c90c6982d2663244333dd0b5105dc09e030729fbd812e33acddf2537a737e4dc87.js integrity="sha512-8WkMRY0Jj0XzOM/udJSYjc+uFneK1VeVK3Ni6LpsVMkMaYLSZjJEMz3QtRBdwJ4DByn72BLjOs3fJTenN+Tchw==" crossorigin=anonymous defer></script>
<div id=copied-alert class="invisible opacity-0 transition-all ease-in-out duration-400 fixed bottom-3 right-10 z-50 flex p-4 mb-4 text-sm text-gray-800 bg-gray-200 rounded-lg dark:bg-gray-500 dark:text-gray-200" role=alert><svg class="inline flex-shrink-0 mr-3 w-5 h-5" viewBox="0 0 24 24" width="24" height="24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
<div>
<span class=font-medium>Code copied</span>
</div>
</div>
</body>
</html>