<!doctype html><html lang=en-us><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>PRC2</title>
<link rel=stylesheet href=https://fontysvenlo.github.io/prc2/css/main.min.d6621c5b88ffd161368965da12fdf1159636782dc4d2bf25c4864da350b7271d5c09686e6557abb46c8017ee3c0eec21d52e19fbed25705a7d53ffe268c93767.css integrity="sha512-1mIcW4j/0WE2iWXaEv3xFZY2eC3E0r8lxIZNo1C3Jx1cCWhuZVertGyAF+48Duwh1S4Z++0lcFp9U//iaMk3Zw==" crossorigin=anonymous>
<link rel=stylesheet href=https://fontysvenlo.github.io/prc2/css/highlight.9e5322c61da2ab0997ce2db01648537ffacdb7b808fc24af4d99ff51257c59db9500031551feb8e62cafde7a246ae2c0015c2862637519a22eb0b49fa7b9d2f9.css integrity="sha512-nlMixh2iqwmXzi2wFkhTf/rNt7gI/CSvTZn/USV8WduVAAMVUf645iyv3nokauLAAVwoYmN1GaIusLSfp7nS+Q==" crossorigin=anonymous>
<link rel=stylesheet href=https://fontysvenlo.github.io/prc2/css/fontawesome.18a15c01c2df9b660114c44bfe1cd143dc48faeea9d5bc11a5b70509d8ec85ae65ac4c6dab72eb09a5c4770d45d6a2d802d28924e739d852a37c1b14f3a9cc61.css integrity="sha512-GKFcAcLfm2YBFMRL/hzRQ9xI+u6p1bwRpbcFCdjsha5lrExtq3LrCaXEdw1F1qLYAtKJJOc52FKjfBsU86nMYQ==" crossorigin=anonymous>
<script src=/prc2/js/init-darkmode.min.09a600ce680e2f21da81abb6c4e0627a5bda42cf7e701bbc3fecdedf5fe0eaa6c82d32cf5c6dac1db60aa93e0d5550c19a6dd8218e6b57e8252979349467ac59.js integrity="sha512-CaYAzmgOLyHagau2xOBielvaQs9+cBu8P+ze31/g6qbILTLPXG2sHbYKqT4NVVDBmm3YIY5rV+glKXk0lGesWQ==" crossorigin=anonymous></script>
</head><body class="antialiased text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800"><header class="sticky top-0 z-40 w-full flex-none lg:border-b lg:border-gray-900/10 dark:border-gray-50/[0.06] bg-white dark:bg-gray-800
border-b border-slate-900/10 lg:border-0 dark:border-slate-300/10">
<div class="max-w-8xl mx-auto">
<div class="py-4 lg:px-8 mx-4 lg:mx-0">
<div class="relative flex items-center">
<button id=menu-toggle type=button class="lg:hidden text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 mr-3">
<span class=sr-only>Navigation</span><svg viewBox="0 0 24 24" width="20" height="20" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<a class="mr-3 flex-none overflow-hidden md:w-auto dark:hover:text-gray-200 hover:text-gray-900" href=https://fontysvenlo.github.io/prc2/>
PRC2
</a>
<div class="relative flex ml-auto">
<nav class="hidden md:flex items-center text-sm leading-6 font-semibold text-gray-700 dark:text-gray-200">
<ul class="flex space-x-8">
<li>
<a href=https://fontysvenlo.github.io/prc2/pages/tips/ class="hover:text-sky-500 dark:hover:text-sky-400">Tips</a>
</li>
<li>
<a href=https://fontysvenlo.github.io/prc2/pages/setup/ class="hover:text-sky-500 dark:hover:text-sky-400">Setup</a>
</li>
</ul>
</nav>
<div class="flex items-center lg:border-l border-gray-200 ml-6 pl-6 dark:border-gray-700">
<button type=button id=theme-toggle>
<span class="dark:hidden hover:text-sky-500"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span>
<span class="hidden dark:inline hover:text-sky-400"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
</button>
<a href=https://github.com/FontysVenlo/prc2 class="ml-6 block hover:text-sky-500 dark:hover:text-sky-400"><svg viewBox="0 0 24 24" width="24" height="24" class="w-5 h-5" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
</div>
</div>
</div>
</div>
</div>
</header><div class="max-w-8xl mx-auto px-4 sm:px-6 md:px-8"><aside id=menu class="hidden lg:block fixed z-20 inset-0 top-[3.5rem] left-[max(0px,calc(50%-45rem))] right-auto w-[19.5rem] pb-10 px-8 overflow-y-auto bg-white dark:bg-gray-800">
<nav class="lg:leading-6 relative">
<ul class="block md:hidden">
<li class="mt-12 lg:mt-8">
<h5 class="mb-8 lg:mb-3 font-semibold text-slate-900 dark:text-slate-200">General</h5>
<ul class="space-y-2 border-l border-gray-100 dark:border-gray-700">
<li>
<a href=https://fontysvenlo.github.io/prc2/pages/tips/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">
Tips
</a>
</li>
<li>
<a href=https://fontysvenlo.github.io/prc2/pages/setup/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">
Setup
</a>
</li>
</ul>
</li>
</ul>
<ul>
<li class="mt-12 lg:mt-8">
<h5 class="mb-8 lg:mb-3 font-semibold text-slate-900 dark:text-slate-200">Weeks</h5>
<ul class="space-y-2 border-l border-gray-100 dark:border-gray-700">
<li>
<a href=https://fontysvenlo.github.io/prc2/docs/unit-testing-basics/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">
Unit Testing Basics
</a>
</li>
<li>
<a href=https://fontysvenlo.github.io/prc2/docs/parameterized-tests/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">
Parameterized tests
</a>
</li>
<li>
<a href=https://fontysvenlo.github.io/prc2/docs/design-for-testability/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">
Desgin for testability
</a>
</li>
<li>
<a href=https://fontysvenlo.github.io/prc2/docs/generics/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">
Generics
</a>
</li>
<li>
<a href=https://fontysvenlo.github.io/prc2/docs/jpms-lambda-streams/ class="block border-l pl-4 -ml-px border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300">
JPMS, Lambda and Streams
</a>
</li>
</ul>
</li>
</ul>
</nav>
</aside><div class=lg:pl-[19.5rem]>
<div class="max-w-3xl mx-auto xl:max-w-none xl:ml-0 xl:mr-[15.5rem] xl:pr-16">
<article id=main-content class="prose prose-slate dark:prose-invert max-w-none dark:prose-a:text-fuchsia-400 prose-a:text-fuchsia-500">
<nav id=toc class=toc role=doc-toc><h2 id=toc-title>Table of Contents</h2><ol class="toc-list level-1"><li><a href=#_generics>Generics</a><ol class="toc-list level-2"><li><a href=#_generics_the_fine_print>Generics, the fine print</a></li><li><a href=#_cheating_the_compiler>Cheating the compiler</a></li><li><a href=#_wildcard_and_bounds>Wildcard and bounds</a></li><li><a href=#_lower_bound_or_contra_variant>Lower bound or Contra variant</a></li><li><a href=#_self_use_in_generic_definitions>Self use in Generic definitions</a></li><li><a href=#_testing_generics>Testing generics</a></li></ol></li></ol></nav><section class="doc-section level-1"><h2 id=_generics>Generics</h2><p>Generics is mainly a compiler feature. In java (at least the versions up to this moment, March 2022) it
is even more so, because after the compiler had itâ€™s go with it, it largely discards the generic information, and the runtime, the JVM,
does not really care about generics and does not use it. The role of generics is to keep the programs type-safe.
The compiler will check that a use of a method, field, or class complies with its definition,
and if the use does <strong class=red>not</strong>, the compiler will produce an <strong class=red>error</strong>, to prevent the programmer from doing unsafe things.</p>
<section class="doc-section level-2"><h3 id=_generics_the_fine_print>Generics, the fine print</h3><p>Generics were introduced in Java 5.</p>
<p>Generics help keeping the language safer by giving the compiler more ways to <em>reason</em>
about the code and reject it when it is bad. That is what a strictly typed language is all about.</p>
<p>With generics also <strong>auto-boxing</strong> was introduced. The concept was borrowed from <strong>C#</strong> and the dot-net framework.
Auto-boxing is auto-magically converting/wrapping an <code>int</code> into an <code>Integer</code> (auto-box) when a
reference type is needed and backwards when the reference type Integer is given and an <code>int</code> is needed (auto-unboxing).
This makes primitive types to play 'nicely' with generics to some degree.</p>
<p>Generics also helps avoiding code duplication, because you can have a <em>something</em> of <em>anything</em>
like a <code class=blue>List</code> of <code class=blue>Student</code> without any code duplication or any code generation under the hood, to create
specialized classes per anything type.
So this <strong class=blue>List</strong> exists once and is just as applicable to Student as is to Donkey.</p>
<p>A strong point of Java has always been the preservation of investment (in code). What worked once should still work.
So code that was legal (and compiled) in the Java 1.1 era should still run, even if used today in its binary format. Heck, in closed
source stuff that might be the only form you have, but your investment is preserved because of this backwards compatibility.</p>
<p>This strong point has a flip side. PrÃ© Java 5 does not understand generics, which would break the backwards compatibility. That
is why the generic info, after being used by the compiler for correctness verification is then thrown away by the same compiler. Little
if anything of the generic information is preserved for the run time. As a matter of fact, the JVM has no notion of generics, nor does it
need it to function. This has all kind of consequences.</p>
<p>In modern Java code, in particular since Java 8 with Functional interfaces and Streams, generics are a <strong>must</strong>, because the provide safety in the one hand
and the required flexibility in the other, required to make the Java 8 features possible at all.</p>
<section class="doc-section level-3"><h4 id=_raw_types_pre_java_5>Raw types, pre-Java 5</h4><p>The pre-java 5 days did not have generics. All types that have been generified since then still exist in their original,
nowadays called <strong class=blue>raw</strong> form. From the above you can infer that this is what the JVM sees and uses.</p>
<figure class=listing-block><figcaption>Using a map in pre Java 5 times</figcaption>
<pre class=highlight><code class=language-java data-lang=java>   Map studentsMap = new HashMap(); <b class=conum>1</b>

   studentsMap.put( Integer.valueOf( 313581 ) ,new Student( &#34;Potter&#34;,&#34;Harry&#34; ) );

   // some time later
   Student harry = (Student) studentsMap.get(Integer.valueOf( 313581 ) ); <b class=conum>2</b></code></pre><ol class="callout-list arabic"><li>The map has no clue about of the types of key or value, so Object is the best it can do.<br>
Also note that you had to turn the <code>int</code> into an <code>Integer</code> object manually, because auto-boxing did not exist.</li><li>Retrieving the object from a map is again wrapping the <code>int</code> and also <em>cast</em> the object back to the expected type.</li></ol></figure>
<p>In the above pieces of code all kinds of things can go wrong. You could put any pair of objects of any type in the map and the compiler
had no way of checking what you did made sense.</p></section>
<section class="doc-section level-3"><h4 id=_generic_types_the_modern_way>Generic types, the modern way.</h4><figure class=listing-block><figcaption>example lists and maps</figcaption>
<pre class=highlight><code class=language-java data-lang=java>   List&lt;String&gt; l1 = new ArrayList&lt;&gt;();
   List&lt;Student&gt; stuList = new ArrayList&lt;&gt;();
   Map&lt;String,BiFunction&lt;Double,Integer,Integer&gt;&gt; operatorMap;</code></pre></figure>
<p>The thing is that the compiler is very finicky. It should be, very precise and meticulous.
As an example, say you have a simple person hierarchy: Person is extended by Student.</p>
<figure class=listing-block><figcaption>some regular people in lists.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>class Person{}
class Student extends Person{}

// in some code
    void m(){
      Person paul = ....
      Student serena = ...
      List&lt;Person&gt; pl;
      List&lt;Student&gt; sl;

    }</code></pre></figure>
<p>The compiler will allow you to do <code>pl.add(serena)</code>, and <code>sl.add(serena)</code> because serena is a <code>Student</code> and by extension a <code>Person</code>, but
paul canâ€™t be added to <code>sl</code>, because as far as the compiler is concerned, paul is not a Student and 'would not fit'.</p>
<p><span class=green>What the compiler tries to achieve is that if you define a collection to contain students, then it promises
that only students will go in and will ever come out. It does that by checking and not accepting any potential violation of the promise.</span></p>
<p>By sticking to this promise, the objects you can receive will be of the correct type and you can do what the type allows, like method calls etc.</p></section></section>
<section class="doc-section level-2"><h3 id=_cheating_the_compiler>Cheating the compiler</h3><p>You can trick the compiler into breaking its promises. In the end, of course the compiler is not the victim, but the program is.
It will generate a <span class=red>ClassCastException</span> on retrieval of the non-fitting object. And as programs go when they generate uncaught exceptions:
they will be aborted by the JVM.</p>
<figure class=listing-block><figcaption>Sneaky code. Do not do this at home. You are only fooling yourselves.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>public static void main( String[] args ) {
        List&lt;Student&gt; sl = new ArrayList&lt;Student&gt;();
        sl.add( new Student( &#34;Hermione&#34; )); <b class=conum>1</b>
        List ol = (List) sl;                <b class=conum>2</b>
        ol.add( new Person(&#34;Voldemort&#34;) );  <b class=conum>3</b>

        // somewhere else in the scenario
        Student hermione = sl.get( 0 );       <b class=conum>4</b>
        Student lilly = sl.get( 1 );        <b class=conum>5</b>
        System.out.println( &#34;lilly = &#34; + lilly ); <b class=conum>6</b>
    }</code></pre><ol class="callout-list arabic"><li>accepted.</li><li>give the compiler a raw alias.</li><li>so it will gladly accept this. You <span class=red>cheated!</span></li><li>no sweat, our heroine pops out,</li><li>but the other object will make your program fail at this statement with a <code class=red>ClassCastException</code>.</li><li>Statement never reached because your program will have been <mark>terminated</mark> by now.</li></ol></figure>
<section class="doc-section level-3"><h4 id=_type_token>Type token.</h4><p><img src=/prc2/images/towerguard.png alt=towerguard width=140px title="guards guards" class="thumb right">
Sometimes you have a problem, which can only be solved by explicitly providing the generic information to
the code at run-time. This use is called 'providing a type-token'.<br>
An example of such use is the method <a href=file:///usr/share/doc/openjdk-11-doc/docs/api/java.base/java/util/Collections.html#checkedList(java.util.List,java.lang.Class)>Collections.checkedList( &lt;List&lt;E>, Class&lt;E> type )</a>,<br>
whose usage example is <code>List&lt;Student> studList = Collections.checkedList( students, Student.class )</code>.<br>
The type token will play the role of a <strong class=blue>sentinel</strong> or <strong class=blue>guard</strong>, because all Class objects have a <code>cast</code> method that checks if the cast is legal, and if it is,
applies the cast to the incoming object; if not it will throw a <span class=red>ClassCastException</span>.
This will prevent even the sneakiest code, including code predating Java 5 and the code above, to sneak in a none-student object.
This guard will also throw an exception, and actually the same one, but now at the side of the culprit, because the exception will be thrown at insertion.
You should not do this as normal usage, because the check on every insertion goes with a cost (CPU cycles), but it can be helpful to detect problems caused
by some naughty code, because now a violation against the promise will result in an exception at run-time,
a <code>ClassCastException</code> to be exact at the moment of insertion, so any sneaky code can be caught <em class=red>red-handed</em>,
leaving a nice big stack trace as a trail for all to see.</p>
<p>There are other uses of type-tokens, which you may see later in the course.</p></section></section>
<section class="doc-section level-2"><h3 id=_wildcard_and_bounds>Wildcard and bounds</h3><p>Read Horstmann section 8.8.</p>
<p>With the definition in the previous paragraphs, you are losing some flexibility, compared to raw types. In particular, you may want
to insert sub types of a class into a collection, or retrieve sub types of a class from a collection.</p>
<p>Using wildcards and bounds will give back some of the flexibility while still upholding type-safety.
The wildcard has been given the character symbol <strong class=bold>'?'</strong>, the question mark.</p>
<section class="doc-section level-3"><h4 id=_unbound_wildcard>Unbound wildcard.</h4><p>The unbound wildcard is something that should be used sparingly. The best example is the new definition of the Class type.
In pre Java-5 times that was <code>Class someClass</code> that is a raw class, nowadays it is <code>Class&lt;?> someClass</code> which actually sounds as a class of any kind.
There is little difference but the compiler will be nicer to you. There are some corner cases where you canâ€™t avoid it and then the form using the wildcard
is the correct choice.</p></section>
<section class="doc-section level-3"><h4 id=_upper_bound_or_covariant>Upper bound or Covariant</h4><figure class=image-block id=supers><img src=/prc2/images/acceptablesupers.svg alt=acceptablesupers>
<figcaption>Figure 1. Hierarchy of shapes, assume mathematical shapes, so a line has no width and hence no surface area. Nor does an arc.</figcaption></figure>
<details class=blue><summary>Quiz: Can you name the super types of circle in the class diagram above?</summary><div class=content><p>Shape, Object, Serializable, ArcLike, Surface, and Circle itself.</p></div></details>
<p>When you intend to write code with high flexibility, in particular when you use inheritance as in <span class=blue>extends</span> and <span class=blue>implements</span>,
then there are a few rules to apply to your generic code. It all has to do with what a container, defined with generic types should <em>accept</em> or will <em>produce</em>.</p>
<p>We will refer to the picture above. We have two scenarios:</p>
<div class="olist arabic"><ol class=arabic><li>A class that makes or <em>supplies</em> shapes. Imagine reading the shape definitions from a drawing file with vector graphics.</li><li>A class that should accept shapes, like a canvas on which you can draw.</li></ol></div>
<p>The supplier or <strong>Producer</strong> as it is called in the documentation, could be some collection such as a <em>list</em> of any of the types in the class diagram:
<code>Object</code>, <code>Serializable</code> (that is probably how the Objects were read from disk), but the most likely and useful would be the <code>Shape</code> type.</p>
<figure class=listing-block><figcaption>Passing things to be drawn to the canvas.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>  interface Canvas {
    void draw( List&lt;Shape&gt; shapes ); <b class=conum>1</b>
  }</code></pre><ol class="callout-list arabic"><li>as far as the draw method is concerned, the list <em>produces</em> the shapes to be drawn.</li></ol></figure>
<p>Now imagine that you have a list of circles: <code>List&lt;Circle> circles = new ArrayList&lt;>()</code>. Then the above definition of the <code>Canvas.draw()</code> method
forbids you to do <code>canvas.draw( circles );</code>, which is quite counter-intuitive, because the class diagram and the code says that a Circle is a Shape.
The compiler will say: '<em>incompatible types: List&lt;Circle> cannot be converted to List&lt;Shape></em>'.</p>
<p>This is because, although a <code>Circle</code> is a sub-class of <code>Shape</code>, a <code>List&lt;Circle></code> is <span class=red>NOT</span> a sub-class of <code>List&lt;Shape></code>.
To amend this problem, you must change the definition of the draw method so that it accepts shapes but also
any derived type. You do that by adding the wild-card which expresses anything (within limits or bounds).</p>
<figure class=listing-block><figcaption>Flexible shape that also accepts lists of sub-classes of Shape.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>  interface Canvas {
    void draw( List&lt;? extends Shape&gt; shapes ); <b class=conum>1</b>
  }</code></pre><ol class="callout-list arabic"><li>This accepts Shape but also anything that is a sub type of Shape, so Circles, Triangles, Lines etc.</li></ol></figure>
<p>This makes the draw method more flexible and reusable, because the draw method can draw any shape now. Type theory calls this kind
of relation between Shape and List of Shape <strong>Covariant</strong>. They both develop in the same direction, so semantically a <code>List&lt;? extends Shape></code> is covariant with
<code>Circle extends Shape</code>. You could say, both extend <em>down</em> and therefor there is an upper bound, <code>Shape</code> in the example.</p></section></section>
<section class="doc-section level-2"><h3 id=_lower_bound_or_contra_variant>Lower bound or Contra variant</h3><p>Now imagine that you have a method in some other class that wants to collect Shapes in a collection like a List.
In the documentation such list, which should accept objects, would be called a <strong>Consumer</strong>.</p>
<figure class=listing-block><figcaption>Passing a container that should receive/consume collected shapes.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>  class Collector {
    // objects are added to be added to receiver or consumer
    void collect( List&lt;Circle&gt; receiver ){ <b class=conum>1</b>
      Circle c =...
      receiver.add( c ); <b class=conum>2</b>
    }
  }</code></pre><ol class="callout-list arabic"><li>Too strict</li><li>Problematic line when widening 1 with extends.</li></ol></figure>
<p>Again, the compiler will complain if you call collect with your list of Circles as input.
Use case: you want to tally up the total area covered by circles.</p>
<p>This time it says the same thing on the call statement <code>collector.collect(circles)</code>. Letâ€™s apply the same solution as above.
If we define the collect method like <code>void collect( List&lt;? extends Circle> receiver )</code>, the compiler will not complain on this line, but
on the line <code>receiver.add( c );</code> with a nasty curse:</p>
<figure class=listing-block><figcaption>Compiler complaint.</figcaption>
<pre class=highlight><code>incompatible types: Circle cannot be converted to CAP#1
  where CAP#1 is a fresh type variable:
    CAP#1 extends Shape from capture of ? extends Shape</code></pre></figure>
<p>So <code>extends</code> is not the way to go. You could infer that the list should be defined such that it accepts the Circle but also any type
that circle extends or, from the stand point of the circle, a super type of Circle. You are actually saying that circle and any of its super types will
be acceptable to the receiver. Circle is the <strong>lower bound</strong> in the example.</p>
<figure class=listing-block><figcaption>Super, that does it.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>class Collector {
    // objects are added to receiver
      void collect( List&lt;? super Circle&gt; receiver ){ <b class=conum>1</b>
        Circle c =...
        receiver.add( c ); <b class=conum>2</b>
      }
}</code></pre><ol class="callout-list arabic"><li><code>super</code> here makes any List of any super type of Circle acceptable to</li><li>the add operation.</li></ol></figure>
<p>The <code>List&lt;? super Circle></code> in the above example is now contra variant with <code>Circle</code>.</p>
<section class="doc-section level-3"><h4 id=_bounds_explained>Bounds explained.</h4><p>The wild card construct with <code>extends</code> or <code>super</code> is called a bounded wild card.</p>
<div class=ulist><ul><li>With <code>extends</code>, which defines the upper-bound, the boundary is the top most type of the acceptable
types, so that that type defines what can be done with it and all its derivatives, like draw().<br>
<code>extends</code> puts a <strong>upper bound</strong> on the element type.</li><li>With <code>super</code>, which defines the <strong>lower-bound</strong>, the bound is the bottom-most type of the acceptable types. It defines the receiver
or consumer of the type. Because that lower bound is the sub-most type of the inheritance hierarchy it is <em>it</em> and all above it, which says
that any consumer (receiver) of such super-type will accept the sub-most or lowest type but also any of the super types.<br>
<code class=blue>super</code> puts a bound on what a consumer like a collection, set or list should accept.</li></ul></div>
<aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip: </span></h6><p>All this bounds stuff is about the direction of the operation, get or put. You can <em>get</em> from a <strong>Producer</strong> and <em>put</em> into a <strong>Consumer</strong>.
The extends bound puts a constraint on the element that are to be produced, the super puts a constraint what the receiver or consumer of the element should accept.<br>
There is a mnemonic for this: <strong class=big>P.E.C.S.</strong>, which says <strong class=big>P</strong>roducer, use <strong class=big>E</strong>xtends, <strong class=big>C</strong>onsumer use <strong class=big>S</strong>uper.<br>
<strong>Note</strong> that put and get both come with other names. For instance, <strong>put</strong> is sometimes called <strong>add</strong>, <strong>push</strong>, or <strong>accept</strong>, according to the naming convention in its context.
Same for <strong>get</strong>, which may answer to the name <strong>pull</strong>, <strong>pop</strong>, <strong>take</strong>, <strong>remove</strong>, etc.</p></aside>
<p><strong>Extends</strong> and covariance is easiest to understand. Contra-variance less so.<br>
As an example for <strong>super</strong>, have a look at the <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/function/Consumer.html target=_blank rel=noopener>Consumer </a>
functional interface. There is a default helper method given that specifies that the Consumer named <strong>after</strong> in the <code>andThen(..)</code>
method must be of type <code>Consumer&lt;? super T></code>,
saying that said consumer must accept Ts, but may also accept any super type of T. And again any consumer that accepts T or any of its super types will do.
You will see this pattern throughout the <code>java.util.function</code> package where a default followup method such as <code>andThen</code> or <code>compose</code> is specified.</p>
<p>The last paragraph makes the point why Functional interfaces and all other goodies introduced in Java 8 heavily rely on generics.</p></section></section>
<section class="doc-section level-2"><h3 id=_self_use_in_generic_definitions>Self use in Generic definitions</h3><p>Generics is not only applicable for collections, although that aspect of the standard Java library is a big customer of this
language feature. But it can be used in other places too, as you have seen in the functional interfaces which define the <strong>shape</strong> of lambda expressions.</p>
<p>You may have come across a generic type definition that looks a bit weird as in, the type is used in its own definition.
An example of that is the definition of the
<a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Enum.html>Enum class</a>,
which the abstract super class of all <strong class=blue>enums</strong>:</p>
<figure class=listing-block><figcaption>Enum class definition, a bit of a mouth-full.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>public abstract class Enum&lt;E extends Enum&lt;E&gt;&gt;
        implements Comparable&lt;E&gt;, Serializable {
}</code></pre></figure>
<p>This definition puts bounds or constraints on the type E, which must hence be a sub type (sub class) of <code>Enum</code> itself.</p>
<aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip: </span></h6><p>The <em>type declaring keywords</em> in Java are <span class=blue>class</span>, <span class=blue>interface</span>, and since Java 5 <span class=blue>enum</span>. Java 14 introduced <span class=blue>record</span>,
which looks a lot like enum in the technique of its definition. It makes an <span class=blue>enum</span> and a <span class=blue>record</span> final, but they can implement interfaces.</p></aside>
<p>Another one is in the use of <code>Comparable</code>, like in the <code>String</code> class,
it says among others <code>String implements Comparable&lt;String></code>, to make Strings comparable to each other, but not to other types.
Again a bound or constraint of types, in the example the parameter of the <code>int compareTo(T)</code> method declared in Comparable.</p>
<p>Let us make a simple and silly but instructive example: A zoo.
We want it to be such that a class inherits all the traits of its super,
and we want to be able to use it in a <em>fluent</em> style of programming.</p>
<figure class=image-block><img src=/prc2/images/zoo.svg alt=zoo>
<figcaption>Figure 2. Mini zoo</figcaption></figure>
<p>In our programs we want to express things like <code>donald.fly().swim().walk()</code>,
which is a common sequence of operations for ducks. We want each of the methods
in the chain to return the duck, so that Donald can do his operations in any order he likes.</p>
<p>This is also understood by the IDE, which will show <em>completions</em> fitting for the duck when the object is a <code>Duck</code>.
For the <code>Bird</code> class on the other hand, the IDE will not <em>complete</em> with <code>swim()</code>, and for the <code>Penguin</code> not with <code>fly()</code>.</p>
<p>To make this work, you need to make your classes as you could say <em>self-aware</em>.
It means that the class in the hierarchy defines a method called <code>self()</code> whose return type is that of the class, not one of the super types.
The self-use in the generics declaration makes this work, in combination with the fact that
each <em class=green>leaf class</em> <a class=footnote-ref id=_footnoteref_1 href=#_footnote_1 title="View footnote 1" role=doc-noteref>[1]</a>
has a <code>self()</code> method which, through convincing the compiler with generics, returns an object of the correct type.
In the definition of each leaf class, the leaf class itself is the type parameter, like in <code>Penguin implements Bird&lt;Penguin>, Swimmer&lt;Penguin></code> etc.
In particular, it is <strong class=red>not</strong> parameterized any further such as <code>Penguin&lt;P></code>, because they themselves are the desired final type or leaf types.</p>
<p>If you want a non-leaf (abstract) class or interface, your have to further use the self reference in the generic definition.</p>
<figure class=listing-block><figcaption>EBird is an extendable Bird</figcaption>
<pre class=highlight><code class=language-java data-lang=java>public interface EBird&lt;EB extends EBird&lt;EB&gt;&gt;  extends Flyer&lt;EB&gt;, Walker&lt;EB&gt;{

     EB afterBurner(){
         System.out.println(&#34;VROOOAAAR&#34;);
         return self();
     }
}</code></pre></figure>
<figure class=listing-block><figcaption>Thunderbird is itâ€™s child.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>public class ThunderBird implements EBird&lt;ThunderBird&gt;{
    public static void main( String[] args ) {
        ThunderBird tb = new ThunderBird();
        tb.fly().move().walk().fly().brood().fly().afterBurner();
    }
}</code></pre></figure>
<aside class="admonition-block tip" role=doc-tip><h6 class="block-title label-only"><span class=title-label>Tip: </span></h6><p><img src=/prc2/images/LeafFarket.png alt=LeafFarket width=100 class="thumb right">
A leaf class is a concrete class at the bottom of the type hierarchy, which is no longer generic on self. In the current implementation you canâ€™t extend it easily.
In java <span class=blue>enum</span> and <span class=blue>record</span> types are also all leaf classes, that cannot be extended.</p></aside>
<p>The code below shows what all this looks like for <code>Bird</code> (providing self), <code>Flyer</code>, and <code>Duck</code>:</p>
<figure class=listing-block><figcaption>Animals can move and are self aware.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>package zoo;

public abstract interface Animal&lt;A extends Animal&lt;A&gt;&gt; {

    default A move() {
        System.out.println( &#34;twitch &#34; );
        return self();
    }

    default A brood() {
        System.out.println( &#34;cosy with my offspring &#34; );
        return self();
    }

    // makes object self aware.
    default A self() {
        return (A) this;
    }

}</code></pre></figure>
<p>The common trait of animals is that they can move. It is in the name. Even coral can move, if not very far.</p>
<figure class=listing-block><figcaption>Flyer adds flying functionality.</figcaption>
<pre class=highlight><code class=language-java data-lang=java>package zoo;

public interface Flyer&lt;F extends Flyer&lt;F&gt;&gt; extends Animal&lt;F&gt; {

    default F fly() {
        System.out.println( &#34;swoosh&#34; );
        return self();
    }
}</code></pre></figure>
<figure class=listing-block><figcaption>Ducks are Animals with many traits, all inherited, and little work. You might think ducks are lazy. ðŸ¦† ðŸ˜Š</figcaption>
<pre class=highlight><code class=language-java data-lang=java>package zoo;

public class Duck implements  Flyer&lt;Duck&gt;, Swimmer&lt;Duck&gt;, Walker&lt;Duck&gt; {

}</code></pre></figure>
<section class=paragraph><h6 class=block-title>you know it is just a model, think movies â€¦â€‹</h6><p><img src=/prc2/images/duckling.jpg alt=duckling width=150 class="thumb left">
The Duck class above is the complete concrete leaf class, nothing has been left out. Everything is in the supers (the interfaces in this case), generics is
just the thread that stitches the Duck together.</p></section>
<p>This all provides the most benefit in Java 8 and up, because from Java 8 interfaces can have <span class=blue>default</span> and <span class=blue>static</span> methods,
thereby implementing things, based on the abstract methods the implementing class must provide, as is the case with <code>self()</code>. And even self() is generified out
by way of convincing the compiler that the default implementation does the trick. <strong class=green>Minimal code with maximum effect</strong>.</p>
<p>The techniques described here are heavily used in the <a href=https://assertj.github.io/doc/>AssertJ</a> library.
The details of this SELF use can be found <a href=https://web.archive.org/web/20130721224442/http:/passion.forco.de/content/emulating-self-types-using-java-generics-simplify-fluent-api-implementation target=_blank rel=noopener>here </a>.</p></section>
<section class="doc-section level-2"><h3 id=_testing_generics>Testing generics</h3><p>As explained, generics is mainly used at the source code level and compiler to check the program for correct use of the declared types and methods. As such, testing of the generic aspect of your code is done when your compiler is happy with it AND you have expressed your real intent. Sometimes the last part is the trickiest.</p></section></section><section class=footnotes aria-label=Footnotes role=doc-endnotes><hr><ol class=footnotes><li class=footnote id=_footnote_1 role=doc-endnote>those at the bottom in the class diagram tree <a class=footnote-backref href=#_footnoteref_1 role=doc-backlink title="Jump to the first occurrence in the text">â†©</a></li></ol></section>
</article>
</div><footer class="text-sm leading-6 mt-12 mb-5">
Theme provided by <a class="text-pink-500 underline" href=https://github.com/FontysVenlo/sebi-theme target=_blank>SeBi Venlo</a>
</footer><div class="fixed z-20 top-[3.8125rem] bottom-0 right-[max(0px,calc(50%-45rem))] w-[19.5rem] py-10 px-8 overflow-y-auto hidden xl:block">
<h5 id=toc-header class="text-slate-900 font-semibold mb-4 text-sm leading-6 dark:text-slate-200">On this page</h5>
<nav id=TableOfContents></nav>
</div></div>
<div class="hidden lg:hidden fixed inset-0 z-10 bg-gray-900/50 dark:bg-gray-900/60" id=menu-backdrop></div>
</div><script src=/prc2/js/main.min.dcd5fa5ed8a3225696c4340d000ecf01b9a284b1d0ce33f8f8c97c54ffd48f2f4cd6d62cb6b1e7f4d26d946f981620a342c939eae57bccd54a854264aa42f737.js integrity="sha512-3NX6XtijIlaWxDQNAA7PAbmihLHQzjP4+Ml8VP/Ujy9M1tYstrHn9NJtlG+YFiCjQsk56uV7zNVKhUJkqkL3Nw==" crossorigin=anonymous></script>
<script src=/prc2/js/highlight.min.4fdca95e2d3efe7ce1c14ca536fc0df95963ccad74d0bad12c90a493703df6fb4607d9a24ee5645fa5df22667b8f1dca010ce51922423191d22aad54e802ba99.js integrity="sha512-T9ypXi0+/nzhwUylNvwN+VljzK100LrRLJCkk3A99vtGB9miTuVkX6XfImZ7jx3KAQzlGSJCMZHSKq1U6AK6mQ==" crossorigin=anonymous defer></script>
<div id=copied-alert class="invisible opacity-0 transition-all ease-in-out duration-400 fixed bottom-3 right-10 z-50 flex p-4 mb-4 text-sm text-gray-800 bg-gray-200 rounded-lg dark:bg-gray-500 dark:text-gray-200" role=alert><svg class="inline flex-shrink-0 mr-3 w-5 h-5" viewBox="0 0 24 24" width="24" height="24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
<div>
<span class=font-medium>Code copied</span>
</div>
</div>
</body>
</html>